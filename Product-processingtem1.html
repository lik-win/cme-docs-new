<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>全国模板</title>
    <link rel="stylesheet" href="/demo.css" />
    <style>
      #img_box1 img{
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="img_box1" style="width: 100%;height: 100%;"></div>
    <script type="text/javascript" src="/libs/cme2d.js"></script>
    <script type="text/javascript" src="/libs/cme-core.umd.cjs"></script>
    <script src="/libs/axios.js"></script>
    <script type="text/javascript">
      const { Map: olmap, View, source, layer, Feature  } = window.CME2D
      let map,vectorS
      let mapObj = null
      let contourLayers=null
      const { blendLayers, style,contourLayer } = window.CMECore
      const { Point, LineString, Polygon, Circle: GeomCircle } = window.CME2D.geom
      const { Circle, Fill, Stroke, Style, Text, Icon } = window.CME2D.style
      const {
        Vector: VectorLayer,
      } = window.CME2D.layer
      const {
        Vector: VectorSource,
      } = window.CME2D.source

      const apiInfo = {
        url: 'http://10.40.88.119:11000/cmes-base-qgis/cmes-qgis/product/indexPicture',
        args: {
          dataPath: {
            value: 'http://10.40.88.119:18097/qgis/test/stem-pano_2024121900.geojson',
            type: 'string',
            required: true,
            desc: 'tif路径',
          },
          type: {
            value: 'geojson',
            type: 'string',
            required: true,
            desc: '类型',
          },
          legendType: {
            value: 'polygon',
            type: 'string',
            required: false,
            desc: '图例类型',
          },
          style: {
            value: 'std',
            type: 'string',
            required: true,
            desc: '样式',
          },
          backName: {
            value: '气温距平实况图',
            type: 'string',
            required: true,
            desc: '背景名称',
          },
          titleTime: {
            value: '12月9日-18日',
            type: 'string',
            required: true,
            desc: '标题时间',
          },
          region: {
            value: 'hnhe',
            type: 'string',
            required: true,
            desc: '区域编码',
          },
          legendName: {
            value: 'temanomaly-S',
            type: 'string',
            required: true,
            desc: '图例名称',
          },
          legendTitle: {
            value: '图例（℃）',
            type: 'string',
            required: true,
            desc: '图例标题',
          },
          makeTime: {
            value: '2024年12月19日15时',
            type: 'string',
            required: true,
            desc: '制作时间',
          },
        },
      }
      function handleQueryString(params) {
        let str = ''
        for (let key in params) {
          str += `${key}=${params[key]}&`
        }
        return str.slice(0, -1)
      }

     function init(params){
      axios.post(apiInfo.url, params).then((res) => {
          if (window.postResult) {
            window.postResult(res.data)
          }
           var img = new Image();
            img.src = res.data.data;
          img.onload = function () {    
             console.log(this);  
             let img_box1=document.getElementById('img_box1')
             while (img_box1.firstChild) {
              img_box1.removeChild(img_box1.firstChild);
             }
             document.getElementById('img_box1').appendChild(this)                
          }
    })
     }
      window.onload = function () {
        let params={
          dataPath: apiInfo.args.dataPath.value,
          type: apiInfo.args.type.value,
          legendType: apiInfo.args.legendType.value,
          style: apiInfo.args.style.value,
          backName: apiInfo.args.backName.value,
          region: apiInfo.args.region.value,
          legendName: apiInfo.args.legendName.value,
          titleTime: apiInfo.args.titleTime.value,
          legendTitle: apiInfo.args.legendTitle.value,
          makeTime: apiInfo.args.makeTime.value
        }
        init(params)
       }

      function onRun(params) {
        init(params)
      } 
    </script>
      <script src="/libs/message.js"></script>
  </body>
</html>
