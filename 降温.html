<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>底图切换</title>
    <link rel="stylesheet" href="/demo.css" />
  </head>

  <body>
    <div id="map"></div>
    <script type="text/javascript" src="/libs/cme2d.js"></script>
    <script type="text/javascript" src="/libs/cme-core.umd.cjs"></script>
    <script type="text/javascript">
      const { Map: olmap, View, source, layer, Feature  } = window.CME2D
    
      let map,vectorS
      const { blendLayers, style } = window.CMECore
      const { Point, LineString, Polygon, Circle: GeomCircle } = window.CME2D.geom
      const { Circle,FillPattern, Fill, Stroke, Style, Text, Icon } = window.CME2D.style
      const {
        Vector: VectorLayer,
      } = window.CME2D.layer
      const {
        Vector: VectorSource,
      } = window.CME2D.source
 
      function initMap(mapEl) {
        vectorS= new VectorSource({
            wrapX: true,
          })
        const map = new olmap({
          target: mapEl, //挂载实例
          layers: [
            new layer.Tile({
              source: new source.XYZ({
                url: 'http://10.0.54.106:8080/windy/{z}/{x}/{y}.png', // 内网地址
              }),
            }),
            new VectorLayer({
              source: vectorS,
              name: 'Point',
            }) 
          ],
          view: new View({
            //地图视图
            center: [106, 35],
            projection: 'EPSG:4326',
            zoom: 5,
            wrapX: true,
          }), //地图设置
          controls: [], //取消地图操作
        })
        return map
      }

      let mapObj = null
      window.onload = function () {
        const mapEl = document.querySelector('#map')
        mapObj = initMap(mapEl)
        mapObj.once('postrender', function () {
          init()
        })
      }

  // 添加落区
  function addFillPattern(url, element) {
    const fillPatternObj = {
      home_weather_sjlt_zone: {
        fill: new FillPattern({
          pattern: 'hatch',
          ratio: 1,
          offset: 0,
          scale: 1,
          size: 1,
          spacing: 0,
          angle: -45,
          color: 'rgba(213,155,211, 1)',
          fill: new Fill({ color: 'rgba(213,155,211, 0.6)' })
        }),
        stroke: null
      },
      home_weather_sjwind_zone: {
        fill: null,
        stroke: new Stroke({
          color: 'rgba(165,18,36,1)',
          width: 2
        })
      },
      home_weather_sjpre_zone: {
        fill: new FillPattern({
          pattern: 'hatch',
          image: new Icon({
            src: rain
          }),
          opacity: 0.6,
          ratio: 1,
          scale: 1
        }),
        stroke: new Stroke({
          color: 'rgba(0,0,0,1)',
          width: 1
        })
      },
      home_weather_snow_zone: {
        fill: new FillPattern({
          pattern: undefined,
          image: new Icon({
            src: snow
          }),
          opacity: 0.5,
          ratio: 1,
          scale: 1
        }),
        stroke: new Stroke({
          color: 'rgba(0,0,0,1)',
          width: 1
        })
      },
      home_weather_sleet_zone: {
        fill: new FillPattern({
          pattern: 'hatch',
          image: new Icon({
            src: rainSnow
          }),
          opacity: 0.5,
          ratio: 1,
          scale: 1
        }),
        stroke: new Stroke({
          color: 'rgba(0,0,0,1)',
          width: 1
        })
      },
      home_weather_stco_zone: {
        fill: new FillPattern({
          pattern: 'hatch',
          ratio: 1,
          offset: 0,
          scale: 0.5,
          size: 1,
          spacing: 0,
          angle: 45,
          color: 'rgba(246,42,53,0.8)',
          fill: new Fill({ color: 'rgba(163,200,164,0.8)' })
        }),
        stroke: new Stroke({
          color: 'rgba(246,42,53,1)',
          width: 2
        })
      },
      home_weather_stco_pre_zone: {
        fill: new FillPattern({
          pattern: 'hatch',
          ratio: 1,
          offset: 0,
          scale: 0.5,
          size: 1,
          spacing: 0,
          angle: 45,
          color: 'rgba(173,204,85,0.8)',
          fill: new Fill({ color: 'rgba(82,209,183,0.8)' })
        }),
        stroke: new Stroke({
          color: 'rgba(227,241,0,1)',
          width: 2
        })
      },
      home_weather_stco_hail_zone: {
        fill: new FillPattern({
          pattern: 'hatch',
          ratio: 1,
          offset: 0,
          scale: 0.5,
          size: 1,
          spacing: 0,
          angle: 90,
          color: 'rgba(4,4,4,0.8)',
          fill: new Fill({ color: 'rgba(178,178,178,0.8)' })
        }),
        stroke: new Stroke({
          color: 'rgba(4,4,4,1)',
          width: 2
        })
      }
    }
    const layer = new VectorLayer({
      zIndex: 100,
      layerName: 'TestLayer',
      source: new VectorSource({
        url,
        format: new GeoJSON()
      }),
      style() {
        return [
          new Style({
            fill: fillPatternObj[element].fill,
            stroke: fillPatternObj[element].stroke
          })
        ]
      }
    })
    return layer
  }
    </script>
  </body>
</html>
