(function(P,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(P=typeof globalThis<"u"?globalThis:P||self,r(P.CMETimeline={},P.Vue))})(this,function(P,r){"use strict";function St(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var ot={exports:{}},Tt=ot.exports,$t;function xt(){return $t||($t=1,function(d,w){(function(k,S){d.exports=S()})(Tt,function(){var k=1e3,S=6e4,b=36e5,B="millisecond",H="second",j="minute",W="hour",O="day",Q="week",C="month",m="quarter",L="year",E="date",tt="Invalid Date",z=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,X=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,q={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(c){var s=["th","st","nd","rd"],n=c%100;return"["+c+(s[(n-20)%10]||s[n]||s[0])+"]"}},N=function(c,s,n){var o=String(c);return!o||o.length>=s?c:""+Array(s+1-o.length).join(n)+c},at={s:N,z:function(c){var s=-c.utcOffset(),n=Math.abs(s),o=Math.floor(n/60),e=n%60;return(s<=0?"+":"-")+N(o,2,"0")+":"+N(e,2,"0")},m:function c(s,n){if(s.date()<n.date())return-c(n,s);var o=12*(n.year()-s.year())+(n.month()-s.month()),e=s.clone().add(o,C),u=n-e<0,f=s.clone().add(o+(u?-1:1),C);return+(-(o+(n-e)/(u?e-f:f-e))||0)},a:function(c){return c<0?Math.ceil(c)||0:Math.floor(c)},p:function(c){return{M:C,y:L,w:Q,d:O,D:E,h:W,m:j,s:H,ms:B,Q:m}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(c){return c===void 0}},x="en",Y={};Y[x]=q;var R="$isDayjsObject",et=function(c){return c instanceof J||!(!c||!c[R])},nt=function c(s,n,o){var e;if(!s)return x;if(typeof s=="string"){var u=s.toLowerCase();Y[u]&&(e=u),n&&(Y[u]=n,e=u);var f=s.split("-");if(!e&&f.length>1)return c(f[0])}else{var p=s.name;Y[p]=s,e=p}return!o&&e&&(x=e),e||!o&&x},$=function(c,s){if(et(c))return c.clone();var n=typeof s=="object"?s:{};return n.date=c,n.args=arguments,new J(n)},h=at;h.l=nt,h.i=et,h.w=function(c,s){return $(c,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var J=function(){function c(n){this.$L=nt(n.locale,null,!0),this.parse(n),this.$x=this.$x||n.x||{},this[R]=!0}var s=c.prototype;return s.parse=function(n){this.$d=function(o){var e=o.date,u=o.utc;if(e===null)return new Date(NaN);if(h.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){var f=e.match(z);if(f){var p=f[2]-1||0,v=(f[7]||"0").substring(0,3);return u?new Date(Date.UTC(f[1],p,f[3]||1,f[4]||0,f[5]||0,f[6]||0,v)):new Date(f[1],p,f[3]||1,f[4]||0,f[5]||0,f[6]||0,v)}}return new Date(e)}(n),this.init()},s.init=function(){var n=this.$d;this.$y=n.getFullYear(),this.$M=n.getMonth(),this.$D=n.getDate(),this.$W=n.getDay(),this.$H=n.getHours(),this.$m=n.getMinutes(),this.$s=n.getSeconds(),this.$ms=n.getMilliseconds()},s.$utils=function(){return h},s.isValid=function(){return this.$d.toString()!==tt},s.isSame=function(n,o){var e=$(n);return this.startOf(o)<=e&&e<=this.endOf(o)},s.isAfter=function(n,o){return $(n)<this.startOf(o)},s.isBefore=function(n,o){return this.endOf(o)<$(n)},s.$g=function(n,o,e){return h.u(n)?this[o]:this.set(e,n)},s.unix=function(){return Math.floor(this.valueOf()/1e3)},s.valueOf=function(){return this.$d.getTime()},s.startOf=function(n,o){var e=this,u=!!h.u(o)||o,f=h.p(n),p=function(a,i){var l=h.w(e.$u?Date.UTC(e.$y,i,a):new Date(e.$y,i,a),e);return u?l:l.endOf(O)},v=function(a,i){return h.w(e.toDate()[a].apply(e.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(i)),e)},M=this.$W,y=this.$M,T=this.$D,F="set"+(this.$u?"UTC":"");switch(f){case L:return u?p(1,0):p(31,11);case C:return u?p(1,y):p(0,y+1);case Q:var V=this.$locale().weekStart||0,t=(M<V?M+7:M)-V;return p(u?T-t:T+(6-t),y);case O:case E:return v(F+"Hours",0);case W:return v(F+"Minutes",1);case j:return v(F+"Seconds",2);case H:return v(F+"Milliseconds",3);default:return this.clone()}},s.endOf=function(n){return this.startOf(n,!1)},s.$set=function(n,o){var e,u=h.p(n),f="set"+(this.$u?"UTC":""),p=(e={},e[O]=f+"Date",e[E]=f+"Date",e[C]=f+"Month",e[L]=f+"FullYear",e[W]=f+"Hours",e[j]=f+"Minutes",e[H]=f+"Seconds",e[B]=f+"Milliseconds",e)[u],v=u===O?this.$D+(o-this.$W):o;if(u===C||u===L){var M=this.clone().set(E,1);M.$d[p](v),M.init(),this.$d=M.set(E,Math.min(this.$D,M.daysInMonth())).$d}else p&&this.$d[p](v);return this.init(),this},s.set=function(n,o){return this.clone().$set(n,o)},s.get=function(n){return this[h.p(n)]()},s.add=function(n,o){var e,u=this;n=Number(n);var f=h.p(o),p=function(y){var T=$(u);return h.w(T.date(T.date()+Math.round(y*n)),u)};if(f===C)return this.set(C,this.$M+n);if(f===L)return this.set(L,this.$y+n);if(f===O)return p(1);if(f===Q)return p(7);var v=(e={},e[j]=S,e[W]=b,e[H]=k,e)[f]||1,M=this.$d.getTime()+n*v;return h.w(M,this)},s.subtract=function(n,o){return this.add(-1*n,o)},s.format=function(n){var o=this,e=this.$locale();if(!this.isValid())return e.invalidDate||tt;var u=n||"YYYY-MM-DDTHH:mm:ssZ",f=h.z(this),p=this.$H,v=this.$m,M=this.$M,y=e.weekdays,T=e.months,F=e.meridiem,V=function(i,l,g,D){return i&&(i[l]||i(o,u))||g[l].slice(0,D)},t=function(i){return h.s(p%12||12,i,"0")},a=F||function(i,l,g){var D=i<12?"AM":"PM";return g?D.toLowerCase():D};return u.replace(X,function(i,l){return l||function(g){switch(g){case"YY":return String(o.$y).slice(-2);case"YYYY":return h.s(o.$y,4,"0");case"M":return M+1;case"MM":return h.s(M+1,2,"0");case"MMM":return V(e.monthsShort,M,T,3);case"MMMM":return V(T,M);case"D":return o.$D;case"DD":return h.s(o.$D,2,"0");case"d":return String(o.$W);case"dd":return V(e.weekdaysMin,o.$W,y,2);case"ddd":return V(e.weekdaysShort,o.$W,y,3);case"dddd":return y[o.$W];case"H":return String(p);case"HH":return h.s(p,2,"0");case"h":return t(1);case"hh":return t(2);case"a":return a(p,v,!0);case"A":return a(p,v,!1);case"m":return String(v);case"mm":return h.s(v,2,"0");case"s":return String(o.$s);case"ss":return h.s(o.$s,2,"0");case"SSS":return h.s(o.$ms,3,"0");case"Z":return f}return null}(i)||f.replace(":","")})},s.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},s.diff=function(n,o,e){var u,f=this,p=h.p(o),v=$(n),M=(v.utcOffset()-this.utcOffset())*S,y=this-v,T=function(){return h.m(f,v)};switch(p){case L:u=T()/12;break;case C:u=T();break;case m:u=T()/3;break;case Q:u=(y-M)/6048e5;break;case O:u=(y-M)/864e5;break;case W:u=y/b;break;case j:u=y/S;break;case H:u=y/k;break;default:u=y}return e?u:h.a(u)},s.daysInMonth=function(){return this.endOf(C).$D},s.$locale=function(){return Y[this.$L]},s.locale=function(n,o){if(!n)return this.$L;var e=this.clone(),u=nt(n,o,!0);return u&&(e.$L=u),e},s.clone=function(){return h.w(this.$d,this)},s.toDate=function(){return new Date(this.valueOf())},s.toJSON=function(){return this.isValid()?this.toISOString():null},s.toISOString=function(){return this.$d.toISOString()},s.toString=function(){return this.$d.toUTCString()},c}(),ft=J.prototype;return $.prototype=ft,[["$ms",B],["$s",H],["$m",j],["$H",W],["$W",O],["$M",C],["$y",L],["$D",E]].forEach(function(c){ft[c[1]]=function(s){return this.$g(s,c[0],c[1])}}),$.extend=function(c,s){return c.$i||(c(s,J,$),c.$i=!0),$},$.locale=nt,$.isDayjs=et,$.unix=function(c){return $(1e3*c)},$.en=Y[x],$.Ls=Y,$.p={},$})}(ot)),ot.exports}var Ct=xt();const mt=St(Ct),ct=3600*1e3,Lt=[{label:"5min",value:5},{label:"6min",value:6},{label:"15min",value:15},{label:"30min",value:30},{label:"1H",value:60},{label:"3H",value:180},{label:"6H",value:360},{label:"12H",value:720},{label:"24H",value:1440},{label:"48H",value:2880},{label:"72H",value:4320}];let U=null;function Et(){return{onPlay:null,params:null,timeField:"",formatter:null}}const A=r.reactive({gmtHours:8,mode:1,tickList:Lt,tick:6,speed:1,tickCount:120,start:rt(6)});function rt(d){return parseInt((Date.now()-d*3600*1e3)/ct)*ct}function Ot(d){return()=>parseInt(d/ct)*ct}const K={STOP:0,READY:1,PLAYING:2};let ht=r.ref(!!K.STOP);const pt=r.ref(null);let gt=rt;const kt=new Map,Ht=r.computed(()=>ht.value);r.watch(()=>A.tick,d=>A.start=gt(d));function _t(d){if(!d){A.start=rt(A.tick);return}if(d.start){gt=Ot(d.start);const w=setTimeout(()=>{clearTimeout(w),gt=rt},20)}Object.assign(A,{mode:1},d)}function It(d,w,k,S){const b=Et();b.onPlay=w,b.timeField=S||"time",b.params=k||{},kt.set(d,b)}function Nt(d,w){if(typeof w!="function"){console.warn('参数"formatter"应为函数！');return}const k=kt.get(d);k&&(k.formatter=w)}function Yt(d,w){const k=kt.get(d);if(!(k!=null&&k.onPlay))return console.error('请调用"addTask"方法设置时间轴播放参数!'),!1;if(w){const{params:S,timeField:b}=w;S&&Object.assign(k.params,S),b&&Object.assign(k,{timeField:b})}return ht.value=!!K.READY,U=k,!0}function Mt(d){const{time:w,timeStamp:k,tickIndex:S}=d;if(!(w&&k))return console.warn("参数缺失！"),K.STOP;if(!U)return K.STOP;let b=w;U.formatter&&(b=U.formatter(k));const{params:B,timeField:H}=U;return B[H]=b,U.onPlay(B,Ht,S),K.PLAYING}function wt(){return{getOptions(){return A.start=rt(A.tick),A},setOptions:_t,syncTickTime(d){if(!(d.time&&d.timeStamp))return console.warn("同步参数错误！");pt.value=d},setCurrentTask(d,w,k){if(Yt(d,w)){if(!(k&&pt.value))return;Mt(pt.value)}},removeCurrentTask(){U=null,ht.value=!!K.STOP},addTask:It,setFormatter:Nt,execute:Mt}}const Ft=(d,w)=>{const k=d.__vccOpts||d;for(const[S,b]of w)k[S]=b;return k},Vt={class:"controls"},Pt={class:"time-axis"},At=["title","onClick"],Bt=["title"],jt={class:"time-tip"},I=12,ut=12,lt=60*1e3,st=3600*1e3,vt=Ft({__name:"Timeline",props:{theme:{type:String,default:"light"}},emits:["tickFocus"],setup(d,{emit:w}){const{execute:k,getOptions:S,setOptions:b,syncTickTime:B}=wt(),H=w,j=d;function W(t,a="warning"){alert(t)}const O=24*st,Q={mounted(t,a){let i=0,l=0,g=!1;const D=t.parentNode.offsetWidth,_=a.value;t.addEventListener("mousedown",Z=>{t.classList.add("dragging"),l=Z.clientX,g=!0}),t.addEventListener("mousemove",Z=>{if(!g)return;const G=Z.clientX-l,it=t.offsetWidth-D+i;i+G>0||it+G<0||(t.style.transform=`translateX(${i+G}px)`,_&&_(i+G))});function dt(){if(!g||(g=!1,t.classList.remove("dragging"),!t.style.transform))return;const Z=t.style.transform.match(/\((.+)\)/)[1];i=parseFloat(Z)}t.addEventListener("mouseleave",dt),t.addEventListener("mouseup",dt)}},C={mounted(t,a){let i=0,l=0,g=0,D=!1;const _=a.value,dt=t.offsetWidth,Z=t.parentNode.offsetWidth;t.addEventListener("mousedown",it=>{i=parseFloat(t.style.left),t.classList.add("dragging"),g=it.clientX,D=!0}),t.addEventListener("mousemove",it=>{if(!D)return;const yt=t.style.transform;if(yt){const Wt=yt.match(/\((.+)\)/)[1];l=parseFloat(Wt)}const Dt=Math.round(it.clientX-g),bt=i+Dt+l+I;bt-dt<I||bt>Z||_&&_(i+Dt)});function G(){D&&(D=!1,i=parseFloat(t.style.left),t.classList.remove("dragging"),_&&_(null,!0))}t.addEventListener("mouseleave",G),t.addEventListener("mouseup",G)}},m=S(),L=r.ref(null),E=r.ref(null),tt=r.ref(!1),z=r.ref([]),X=r.ref(0),q=r.ref(0),N=r.ref(I),at=r.ref(null),x=r.ref(!1);function Y(){x.value=!x.value}const R=r.computed(()=>m.mode===2),et=r.computed(()=>R.value?m.start+m.tick*lt:Date.now()),nt=r.toRef(m,"tick"),$=r.toRef(m,"start");r.watch(nt,()=>o(!0)),r.watch($,()=>o(!0)),r.watch(x,t=>{if(!t||e.value)return;const a=et.value-m.start,i=Math.floor(a/(m.tick*lt))<90;!i&&b(),o(!0,i)});function h(t,a){return R.value?a%12===0:m.tick<20?t.getMinutes()===0:m.tick<=60?!(t.getHours()%6)&&!t.getMinutes():m.tick<400?t.getHours()===0:a%10===0}function J(){if(R.value)return parseInt(m.start/st)*st;const t=m.tick>100?O:st;let a=parseInt(m.start/t)*t;return t===O&&(a-=m.gmtHours*st),a}function ft(){const t=J(),a=m.tick<150?"HH:mm":"MM/DD",i=m.tick>=1440?"MM/DD":"MM/DD HH:mm";z.value=new Array(m.tickCount).fill(0).map((l,g)=>{const D=mt(t).add(m.tick*g,"minute"),_={time:D.$d.getTime(),desc:D.format(i)};return h(D.$d,g)&&(_.label=R.value?D.format("MM/DD HH:mm"):D.format(a)),_})}function c(t,a){if(R.value){const i=m.tick/60<24,l=Math.round(t*10*(m.tick/60))/10;return i?`${l}小时`:l<=144?`${l}小时`:`${parseInt(l/24)}天`}return m.tick>400?a:a.split(" ")[1]}function s(t,a){if(!E.value)return;typeof t=="number"&&(N.value=t),E.value.style.left=`${N.value}px`;const i=Math.round((N.value-I)/ut);if(i<m.tickCount){const{desc:l,time:g}=z.value[i];at.value=c(i,l);const D=mt(g).format("YYYYMMDDHHmm00");B({timeStamp:g,time:D,idx:i})}a&&(N.value-=m.speed,T(!1))}function n(t){E.value&&(E.value.style.transform=`translateX(${t}px)`)}function o(t,a){!a&&ft(),Promise.resolve().then(()=>{const i=et.value-J(),l=Math.floor(i/(m.tick*lt));if(X.value=Math.min(Math.max(0,l),m.tickCount-1),l===q.value){at.value=c(l,z.value[l].desc);return}if(l<0||l>=m.tickCount){const g=t?I-2:I;return s(g,!!t)}p(l,!!t)})}const e=r.ref(null);function u(){e.value&&(clearInterval(e.value),e.value=null,tt.value=!1)}function f(t){if(t>=m.tickCount||t<0)return;const a=z.value[t],i=mt(a.time).format("YYYYMMDDHHmm00"),l={timeStamp:a.time,time:i,tickIndex:t};H("tickFocus",l),!k(l)&&u()}function p(t,a){if(u(),!L.value)return;if(y(t)!==t)return W("所选时间不合理！");L.value.children[t]&&(q.value=t,s(t*ut+I),a&&f(t))}function v(t){x.value=!1;const a=q.value+t,i=Math.max(Math.min(z.value.length,a),0);p(i,!0)}function M(t,a){return t>=a[0]&&t<=a[1]}function y(t,a){const i=[0,m.tickCount-1],l=M(X.value,i);m.mode===1?i[1]=l?X.value:m.tickCount-1:m.mode===2&&(i[0]=l?X.value:0);const g=Math.min(Math.max(t,i[0]),i[1]);return t!==g?a?i[0]:g:t}function T(t){let a=N.value+m.speed;const i=Math.ceil((a-I)/ut),l=y(i,t);i!==l&&(a=l*ut+I),s(a),q.value!==l&&(q.value=l,f(l))}function F(t){if(tt.value=t,!t)return u();e.value||(x.value=!1,e.value=setInterval(T,200,!0))}const V=setInterval(()=>{if(!x.value||e.value)return;const t=new Date().getMinutes();o(x.value,!t)},lt);return r.onMounted(()=>o()),r.onBeforeUnmount(()=>{clearInterval(V),e.value&&u()}),(t,a)=>(r.openBlock(),r.createElementBlock("div",{class:r.normalizeClass(["timeline radius2",j.theme])},[r.createElementVNode("div",Vt,[r.createElementVNode("a",{class:"icon-btn",onClick:a[0]||(a[0]=i=>v(-2))},a[4]||(a[4]=[r.createElementVNode("svg",{"view-box":"0 0 32 32",width:"32",height:"32",xmlns:"https://www.w3.org/2000/svg"},[r.createElementVNode("path",{stroke:"currentColor","stroke-width":"3",d:"M8,8 L8,24z"}),r.createElementVNode("path",{fill:"currentColor",d:"M24,6 L24,26 L8,16z"})],-1)])),tt.value?(r.openBlock(),r.createElementBlock("a",{key:0,class:"icon-btn",onClick:a[1]||(a[1]=i=>F(!1))},a[5]||(a[5]=[r.createElementVNode("svg",{"view-box":"0 0 32 32",width:"32",height:"32",xmlns:"https://www.w3.org/2000/svg"},[r.createElementVNode("path",{stroke:"currentColor","stroke-width":"3",d:"M11,6 L11,24z"}),r.createElementVNode("path",{stroke:"currentColor","stroke-width":"3",d:"M21,6 L21 24z"})],-1)]))):(r.openBlock(),r.createElementBlock("a",{key:1,class:"icon-btn",onClick:a[2]||(a[2]=i=>F(!0))},a[6]||(a[6]=[r.createElementVNode("svg",{"view-box":"0 0 32 32",width:"32",height:"32",xmlns:"https://www.w3.org/2000/svg"},[r.createElementVNode("path",{fill:"currentColor",d:"M9,6 L9,26 L25,16z"})],-1)]))),r.createElementVNode("a",{class:"icon-btn",onClick:a[3]||(a[3]=i=>v(2))},a[7]||(a[7]=[r.createElementVNode("svg",{"view-box":"0 0 32 32",width:"32",height:"32",xmlns:"https://www.w3.org/2000/svg"},[r.createElementVNode("path",{stroke:"currentColor","stroke-width":"3",d:"M24,8 L24,24z"}),r.createElementVNode("path",{fill:"currentColor",d:"M8,6 L8,26 L24,16z"})],-1)])),r.createElementVNode("a",{class:r.normalizeClass(["icon-btn",{on:x.value}]),title:"自动刷新",onClick:Y},a[8]||(a[8]=[r.createStaticVNode('<svg viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg" data-v-981816d9><path fill="transparent" stroke="currentColor" stroke-width="3" d="M12,7 A8,8 45,0,1 20.6,20" data-v-981816d9></path><path fill="currentColor" d="M9,8.8 L13.5,10, L10.8,4.2z" data-v-981816d9></path><path fill="transparent" stroke="currentColor" stroke-width="3" d="M8.2,10 A8,8 45,0,0 18,22" data-v-981816d9></path><path fill="currentColor" d="M16.2,19.4 L20,21, L18.4,25.2z" data-v-981816d9></path></svg>',1)]),2)]),r.createElementVNode("div",Pt,[r.withDirectives((r.openBlock(),r.createElementBlock("div",{class:"axis",ref_key:"ticksRef",ref:L},[(r.openBlock(!0),r.createElementBlock(r.Fragment,null,r.renderList(z.value,(i,l)=>(r.openBlock(),r.createElementBlock("i",{class:r.normalizeClass({long:!!i.label,current:X.value===l}),title:i.desc,onClick:g=>p(l,!0)},[i.label?(r.openBlock(),r.createElementBlock("label",{key:0,title:i.desc},r.toDisplayString(i.label),9,Bt)):r.createCommentVNode("",!0)],10,At))),256))])),[[Q,n]]),r.withDirectives((r.openBlock(),r.createElementBlock("a",{class:"tick-marker",ref_key:"markerRef",ref:E},[r.createElementVNode("span",jt,r.toDisplayString(at.value),1)])),[[C,s]])])],2))}},[["__scopeId","data-v-981816d9"]]);vt.install=function(d){d.component("cme-timeline",vt)},P.Timeline=vt,P.useTimeline=wt,Object.defineProperty(P,Symbol.toStringTag,{value:"Module"})});
