/*! For license information please see createVectorTileGeometries.js.LICENSE.txt */
import{a as P}from"./chunk-LL4PRXXO.js";import{a as z}from"./chunk-W5FWNHP7.js";import"./chunk-W2LU7RJ5.js";import{a as H}from"./chunk-BSL4RZYV.js";import{a as Y}from"./chunk-RIW4PILL.js";import{a as j}from"./chunk-G2BB42Z6.js";import"./chunk-6GG6EJBW.js";import"./chunk-TXLODGLR.js";import{a as W}from"./chunk-DBOVA5XH.js";import"./chunk-RHEGXTJ5.js";import"./chunk-CWBIOT2C.js";import{d as E}from"./chunk-PPN6SLYU.js";import{b as d}from"./chunk-SOWUYSYI.js";import"./chunk-I36V6CKP.js";import{a as o}from"./chunk-WG62ICZK.js";import"./chunk-EEN7GMYN.js";import"./chunk-SXYTVHGU.js";import"./chunk-RAWIUDJR.js";import"./chunk-KGKDCW56.js";import"./chunk-G4IO3CPJ.js";import{e as l}from"./chunk-GBRF7ES3.js";function X(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var J=X,S=new o,$=d.packedLength+o.packedLength,ee=d.packedLength+2,ne=d.packedLength+o.packedLength,te=o.packedLength+1,u={modelMatrix:new d,boundingVolume:new E};function oe(e,t){let n=t*$,r=o.unpack(e,n,S);n+=o.packedLength;let i=d.unpack(e,n,u.modelMatrix);d.multiplyByScale(i,r,i);let s=u.boundingVolume;return o.clone(o.ZERO,s.center),s.radius=Math.sqrt(3),u}function ce(e,t){let n=t*ee,r=e[n++],i=e[n++],s=o.fromElements(r,r,i,S),a=d.unpack(e,n,u.modelMatrix);d.multiplyByScale(a,s,a);let l=u.boundingVolume;return o.clone(o.ZERO,l.center),l.radius=Math.sqrt(2),u}function se(e,t){let n=t*ne,r=o.unpack(e,n,S);n+=o.packedLength;let i=d.unpack(e,n,u.modelMatrix);d.multiplyByScale(i,r,i);let s=u.boundingVolume;return o.clone(o.ZERO,s.center),s.radius=1,u}function ie(e,t){let n=t*te,r=e[n++],i=o.unpack(e,n,S),s=d.fromTranslation(i,u.modelMatrix);d.multiplyByUniformScale(s,r,s);let a=u.boundingVolume;return o.clone(o.ZERO,a.center),a.radius=1,u}var de=new o;function R(e,t,n,r,i){if(!l(t))return;let s=n.length,a=r.attributes.position.values,c=r.indices,u=e.positions,f=e.vertexBatchIds,h=e.indices,p=e.batchIds,m=e.batchTableColors,b=e.batchedIndices,k=e.indexOffsets,g=e.indexCounts,I=e.boundingVolumes,y=e.modelMatrix,x=e.center,B=e.positionOffset,w=e.batchIdIndex,O=e.indexOffset,j=e.batchedIndicesOffset;for(let e=0;e<s;++e){let r=i(t,e),s=r.modelMatrix;d.multiply(y,s,s);let l=n[e],L=a.length;for(let e=0;e<L;e+=3){let t=o.unpack(a,e,de);d.multiplyByPoint(s,t,t),o.subtract(t,x,t),o.pack(t,u,3*B+e),f[w++]=l}let A=c.length;for(let e=0;e<A;++e)h[O+e]=c[e]+B;let R=e+j;b[R]=new J({offset:O,count:A,color:P.fromRgba(m[l]),batchIds:[l]}),p[R]=l,k[R]=O,g[R]=A,I[R]=E.transform(r.boundingVolume,s),B+=L/3,O+=A}e.positionOffset=B,e.batchIdIndex=w,e.indexOffset=O,e.batchedIndicesOffset+=s}var K=new o,Q=new d;function re(e){let t=new Float64Array(e),n=0;o.unpack(t,n,K),n+=o.packedLength,d.unpack(t,n,Q)}function le(e){let t=e.length,n=0;for(let o=0;o<t;++o)n+=P.packedLength+3+e[o].batchIds.length;return n}function ae(e,t,n){let o=n.length,r=2+o*E.packedLength+1+le(t),i=new Float64Array(r),s=0;i[s++]=e,i[s++]=o;for(let e=0;e<o;++e)E.pack(n[e],i,s),s+=E.packedLength;let a=t.length;i[s++]=a;for(let e=0;e<a;++e){let n=t[e];P.pack(n.color,i,s),s+=P.packedLength,i[s++]=n.offset,i[s++]=n.count;let o=n.batchIds,r=o.length;i[s++]=r;for(let e=0;e<r;++e)i[s++]=o[e]}return i}function fe(e,t){let n=l(e.boxes)?new Float32Array(e.boxes):void 0,o=l(e.boxBatchIds)?new Uint16Array(e.boxBatchIds):void 0,r=l(e.cylinders)?new Float32Array(e.cylinders):void 0,i=l(e.cylinderBatchIds)?new Uint16Array(e.cylinderBatchIds):void 0,s=l(e.ellipsoids)?new Float32Array(e.ellipsoids):void 0,a=l(e.ellipsoidBatchIds)?new Uint16Array(e.ellipsoidBatchIds):void 0,c=l(e.spheres)?new Float32Array(e.spheres):void 0,d=l(e.sphereBatchIds)?new Uint16Array(e.sphereBatchIds):void 0,u=l(n)?o.length:0,f=l(r)?i.length:0,h=l(s)?a.length:0,p=l(c)?d.length:0,m=j.getUnitBox(),b=z.getUnitCylinder(),k=H.getUnitEllipsoid(),g=m.attributes.position.values,I=b.attributes.position.values,y=k.attributes.position.values,x=g.length*u;x+=I.length*f,x+=y.length*(h+p);let B=m.indices,w=b.indices,O=k.indices,L=B.length*u;L+=w.length*f,L+=O.length*(h+p);let E=new Float32Array(x),A=new Uint16Array(x/3),v=W.createTypedArray(x/3,L),U=u+f+h+p,S=new Uint16Array(U),P=new Array(U),C=new Uint32Array(U),M=new Uint32Array(U),V=new Array(U);re(e.packedBuffer);let G={batchTableColors:new Uint32Array(e.batchTableColors),positions:E,vertexBatchIds:A,indices:v,batchIds:S,batchedIndices:P,indexOffsets:C,indexCounts:M,boundingVolumes:V,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:Q,center:K};R(G,n,o,m,oe),R(G,r,i,b,ce),R(G,s,a,k,se),R(G,c,d,k,ie);let T=ae(v.BYTES_PER_ELEMENT,P,V);return t.push(E.buffer,A.buffer,v.buffer),t.push(S.buffer,C.buffer,M.buffer),t.push(T.buffer),{positions:E.buffer,vertexBatchIds:A.buffer,indices:v.buffer,indexOffsets:C.buffer,indexCounts:M.buffer,batchIds:S.buffer,packedBuffer:T.buffer}}var Oe=Y(fe);export{Oe as default};