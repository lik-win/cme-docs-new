const _0x222c30=_0x5754;(function(_0x5f5a25,_0x566d93){const _0x317f39=_0x5754,_0x2871ce=_0x5f5a25();while(!![]){try{const _0x52d8ae=-parseInt(_0x317f39(0x159))/0x1+-parseInt(_0x317f39(0x157))/0x2+-parseInt(_0x317f39(0x136))/0x3*(-parseInt(_0x317f39(0x145))/0x4)+-parseInt(_0x317f39(0x16f))/0x5+parseInt(_0x317f39(0x170))/0x6+parseInt(_0x317f39(0x16a))/0x7*(-parseInt(_0x317f39(0x169))/0x8)+parseInt(_0x317f39(0x156))/0x9;if(_0x52d8ae===_0x566d93)break;else _0x2871ce['push'](_0x2871ce['shift']());}catch(_0x50da45){_0x2871ce['push'](_0x2871ce['shift']());}}}(_0x5e91,0xc42d6));import _0x5c4aa8 from'../CollectionEventType.js';import _0x2ec827 from'../events/EventType.js';import _0xf32593 from'./Pointer.js';import _0x54688e from'../structs/RBush.js';import _0x11beb0 from'../source/VectorEventType.js';import{FALSE,TRUE}from'../functions.js';import{SnapEvent,SnapEventType}from'../events/SnapEvent.js';import{boundingExtent,buffer,createEmpty}from'../extent.js';import{closestOnCircle,closestOnSegment,squaredDistance}from'../coordinate.js';import{fromCircle}from'../geom/Polygon.js';import{fromUserCoordinate,getUserProjection,toUserCoordinate,toUserExtent}from'../proj.js';function _0x5754(_0x3fa341,_0x402eef){const _0x5e9132=_0x5e91();return _0x5754=function(_0x57542b,_0x1f6ea0){_0x57542b=_0x57542b-0x127;let _0x317636=_0x5e9132[_0x57542b];return _0x317636;},_0x5754(_0x3fa341,_0x402eef);}import{getUid}from'../util.js';import{listen,unlistenByKey}from'../events.js';function getFeatureFromEvent(_0x5172b9){const _0x142ed9=_0x5754;if(_0x5172b9[_0x142ed9(0x15c)])return _0x5172b9[_0x142ed9(0x15c)];if(_0x5172b9[_0x142ed9(0x14f)])return _0x5172b9['element'];return null;}function _0x5e91(){const _0x34e6e3=['getFeatures','handlingDownUpSequence','insert','getGeometry','28EvcrXu','source_','segmentCircleGeometry_','REMOVE','updateFeature_','pixelTolerance_','removeFeature','CHANGE','stopDown','once','element','vertexPixel','segmentGeometryCollectionGeometry_','snapTo','handleDownEvent','rBush_','features','35249769TelQkr','3017226MLyJVg','length','1460981Xlntxd','segmentPointGeometry_','edge','feature','getFeatures_','edge_','segmentPolygonGeometry_','handleFeatureRemove_','GEOMETRY_SEGMENTERS_','getResolution','push','slice','forEach','ADD','ADDFEATURE','getInExtent','4432rAUVxE','2429fBqbez','segment','map','load','pixelTolerance','2418450AkjMZc','2424888iavogr','getCoordinates','handleFeatureChange_','segmentLineStringGeometry_','SNAP','setMap','REMOVEFEATURE','getMap','getExtent','indexedFeaturesExtents_','vertex','pendingFeatures_','getView','segmentMultiLineStringGeometry_','clear','handleEvent','clone','coordinate','bind','addFeature','round','Circle','getType','vertex_','pixel','dispatchEvent','segmentMultiPolygonGeometry_','54975ftgwJo','source','featureChangeListenerKeys_','getGeometriesArray','features_','values','transform','featuresListenerKeys_','segmentMultiPointGeometry_','handleFeatureAdd_','getProjection'];_0x5e91=function(){return _0x34e6e3;};return _0x5e91();}const tempSegment=[];class Snap extends _0xf32593{constructor(_0x55a907){const _0x58c0b1=_0x5754;_0x55a907=_0x55a907?_0x55a907:{};const _0x458108=_0x55a907;!_0x458108[_0x58c0b1(0x153)]&&(_0x458108[_0x58c0b1(0x153)]=TRUE),!_0x458108[_0x58c0b1(0x14d)]&&(_0x458108['stopDown']=FALSE),super(_0x458108),this['on'],this[_0x58c0b1(0x14e)],this['un'],this[_0x58c0b1(0x146)]=_0x55a907[_0x58c0b1(0x137)]?_0x55a907[_0x58c0b1(0x137)]:null,this[_0x58c0b1(0x132)]=_0x55a907[_0x58c0b1(0x17a)]!==undefined?_0x55a907[_0x58c0b1(0x17a)]:!![],this[_0x58c0b1(0x15e)]=_0x55a907['edge']!==undefined?_0x55a907[_0x58c0b1(0x15b)]:!![],this['features_']=_0x55a907[_0x58c0b1(0x155)]?_0x55a907[_0x58c0b1(0x155)]:null,this[_0x58c0b1(0x13d)]=[],this['featureChangeListenerKeys_']={},this[_0x58c0b1(0x179)]={},this[_0x58c0b1(0x17b)]={},this['pixelTolerance_']=_0x55a907[_0x58c0b1(0x16e)]!==undefined?_0x55a907[_0x58c0b1(0x16e)]:0xa,this[_0x58c0b1(0x154)]=new _0x54688e(),this['GEOMETRY_SEGMENTERS_']={'Point':this[_0x58c0b1(0x15a)][_0x58c0b1(0x12d)](this),'LineString':this[_0x58c0b1(0x173)]['bind'](this),'LinearRing':this[_0x58c0b1(0x173)][_0x58c0b1(0x12d)](this),'Polygon':this[_0x58c0b1(0x15f)]['bind'](this),'MultiPoint':this[_0x58c0b1(0x13e)][_0x58c0b1(0x12d)](this),'MultiLineString':this[_0x58c0b1(0x128)]['bind'](this),'MultiPolygon':this['segmentMultiPolygonGeometry_'][_0x58c0b1(0x12d)](this),'GeometryCollection':this[_0x58c0b1(0x151)]['bind'](this),'Circle':this[_0x58c0b1(0x147)][_0x58c0b1(0x12d)](this)};}[_0x222c30(0x12e)](_0xc6f63f,_0x3f287c){const _0x50944d=_0x222c30;_0x3f287c=_0x3f287c!==undefined?_0x3f287c:!![];const _0x4e4b0a=getUid(_0xc6f63f),_0x1d3d22=_0xc6f63f[_0x50944d(0x144)]();if(_0x1d3d22){const _0x454553=this[_0x50944d(0x161)][_0x1d3d22[_0x50944d(0x131)]()];if(_0x454553){this[_0x50944d(0x179)][_0x4e4b0a]=_0x1d3d22[_0x50944d(0x178)](createEmpty());const _0x42906e=[];_0x454553(_0x42906e,_0x1d3d22);if(_0x42906e[_0x50944d(0x158)]===0x1)this[_0x50944d(0x154)][_0x50944d(0x143)](boundingExtent(_0x42906e[0x0]),{'feature':_0xc6f63f,'segment':_0x42906e[0x0]});else{if(_0x42906e[_0x50944d(0x158)]>0x1){const _0xdea193=_0x42906e['map'](_0x43f000=>boundingExtent(_0x43f000)),_0x323092=_0x42906e['map'](_0x5dfb08=>({'feature':_0xc6f63f,'segment':_0x5dfb08}));this[_0x50944d(0x154)][_0x50944d(0x16d)](_0xdea193,_0x323092);}}}}_0x3f287c&&(this[_0x50944d(0x138)][_0x4e4b0a]=listen(_0xc6f63f,_0x2ec827[_0x50944d(0x14c)],this[_0x50944d(0x172)],this));}[_0x222c30(0x15d)](){const _0x5bdacd=_0x222c30;let _0x13024c;if(this['features_'])_0x13024c=this[_0x5bdacd(0x13a)];else this[_0x5bdacd(0x146)]&&(_0x13024c=this[_0x5bdacd(0x146)][_0x5bdacd(0x141)]());return _0x13024c;}[_0x222c30(0x12a)](_0x57738f){const _0x4af906=_0x222c30,_0x1441a5=this[_0x4af906(0x152)](_0x57738f['pixel'],_0x57738f['coordinate'],_0x57738f[_0x4af906(0x16c)]);return _0x1441a5&&(_0x57738f[_0x4af906(0x12c)]=_0x1441a5[_0x4af906(0x17a)][_0x4af906(0x164)](0x0,0x2),_0x57738f[_0x4af906(0x133)]=_0x1441a5[_0x4af906(0x150)],this[_0x4af906(0x134)](new SnapEvent(SnapEventType[_0x4af906(0x174)],{'vertex':_0x57738f[_0x4af906(0x12c)],'vertexPixel':_0x57738f[_0x4af906(0x133)],'feature':_0x1441a5[_0x4af906(0x15c)],'segment':_0x1441a5['segment']}))),super['handleEvent'](_0x57738f);}[_0x222c30(0x13f)](_0x2a265e){const _0x59463a=getFeatureFromEvent(_0x2a265e);_0x59463a&&this['addFeature'](_0x59463a);}['handleFeatureRemove_'](_0x708e28){const _0x477beb=_0x222c30,_0x35d932=getFeatureFromEvent(_0x708e28);_0x35d932&&this[_0x477beb(0x14b)](_0x35d932);}[_0x222c30(0x172)](_0x4deb8f){const _0x2f5d41=_0x222c30,_0x111fad=_0x4deb8f['target'];if(this[_0x2f5d41(0x142)]){const _0x1000ec=getUid(_0x111fad);!(_0x1000ec in this[_0x2f5d41(0x17b)])&&(this['pendingFeatures_'][_0x1000ec]=_0x111fad);}else this[_0x2f5d41(0x149)](_0x111fad);}['handleUpEvent'](_0x49b20c){const _0x15218e=_0x222c30,_0x41e8b6=Object[_0x15218e(0x13b)](this[_0x15218e(0x17b)]);return _0x41e8b6['length']&&(_0x41e8b6[_0x15218e(0x165)](this[_0x15218e(0x149)]['bind'](this)),this[_0x15218e(0x17b)]={}),![];}[_0x222c30(0x14b)](_0x56ee6c,_0x279cf3){const _0x530e69=_0x222c30,_0x1ffd9a=_0x279cf3!==undefined?_0x279cf3:!![],_0x44127c=getUid(_0x56ee6c),_0x2a8870=this['indexedFeaturesExtents_'][_0x44127c];if(_0x2a8870){const _0x3803c5=this[_0x530e69(0x154)],_0xd6be95=[];_0x3803c5['forEachInExtent'](_0x2a8870,function(_0xe85f1a){const _0x20272b=_0x530e69;_0x56ee6c===_0xe85f1a[_0x20272b(0x15c)]&&_0xd6be95[_0x20272b(0x163)](_0xe85f1a);});for(let _0x3641fb=_0xd6be95[_0x530e69(0x158)]-0x1;_0x3641fb>=0x0;--_0x3641fb){_0x3803c5['remove'](_0xd6be95[_0x3641fb]);}}_0x1ffd9a&&(unlistenByKey(this[_0x530e69(0x138)][_0x44127c]),delete this[_0x530e69(0x138)][_0x44127c]);}[_0x222c30(0x175)](_0x3f91ae){const _0x357502=_0x222c30,_0x4e2acf=this[_0x357502(0x177)](),_0x5afd97=this[_0x357502(0x13d)],_0x5f43b9=this[_0x357502(0x15d)]();_0x4e2acf&&(_0x5afd97['forEach'](unlistenByKey),_0x5afd97[_0x357502(0x158)]=0x0,this['rBush_'][_0x357502(0x129)](),Object[_0x357502(0x13b)](this[_0x357502(0x138)])['forEach'](unlistenByKey),this[_0x357502(0x138)]={});super[_0x357502(0x175)](_0x3f91ae);if(_0x3f91ae){if(this[_0x357502(0x13a)])_0x5afd97[_0x357502(0x163)](listen(this[_0x357502(0x13a)],_0x5c4aa8[_0x357502(0x166)],this[_0x357502(0x13f)],this),listen(this[_0x357502(0x13a)],_0x5c4aa8[_0x357502(0x148)],this['handleFeatureRemove_'],this));else this['source_']&&_0x5afd97['push'](listen(this['source_'],_0x11beb0[_0x357502(0x167)],this['handleFeatureAdd_'],this),listen(this[_0x357502(0x146)],_0x11beb0[_0x357502(0x176)],this[_0x357502(0x160)],this));_0x5f43b9[_0x357502(0x165)](_0x5ae40b=>this[_0x357502(0x12e)](_0x5ae40b));}}['snapTo'](_0xc380a8,_0x2fa3f1,_0x206f77){const _0x1ebe2e=_0x222c30,_0x2788e4=_0x206f77['getView']()['getProjection'](),_0x471ee1=fromUserCoordinate(_0x2fa3f1,_0x2788e4),_0x3555ed=toUserExtent(buffer(boundingExtent([_0x471ee1]),_0x206f77[_0x1ebe2e(0x127)]()[_0x1ebe2e(0x162)]()*this[_0x1ebe2e(0x14a)]),_0x2788e4),_0x2b7577=this[_0x1ebe2e(0x154)][_0x1ebe2e(0x168)](_0x3555ed),_0x369942=_0x2b7577[_0x1ebe2e(0x158)];if(_0x369942===0x0)return null;let _0x58ba09,_0x8dc504=Infinity,_0x15e55f,_0xc11255=null;const _0x335318=this['pixelTolerance_']*this[_0x1ebe2e(0x14a)],_0x2ee257=()=>{const _0xac98d3=_0x1ebe2e;if(_0x58ba09){const _0x1b72e4=_0x206f77['getPixelFromCoordinate'](_0x58ba09),_0x239b37=squaredDistance(_0xc380a8,_0x1b72e4);if(_0x239b37<=_0x335318)return{'vertex':_0x58ba09,'vertexPixel':[Math[_0xac98d3(0x12f)](_0x1b72e4[0x0]),Math[_0xac98d3(0x12f)](_0x1b72e4[0x1])],'feature':_0x15e55f,'segment':_0xc11255};}return null;};if(this['vertex_']){for(let _0x2e671f=0x0;_0x2e671f<_0x369942;++_0x2e671f){const _0x375e65=_0x2b7577[_0x2e671f];_0x375e65[_0x1ebe2e(0x15c)][_0x1ebe2e(0x144)]()[_0x1ebe2e(0x131)]()!==_0x1ebe2e(0x130)&&_0x375e65[_0x1ebe2e(0x16b)]['forEach'](_0x50bde2=>{const _0x33b59a=_0x1ebe2e,_0xe5152=fromUserCoordinate(_0x50bde2,_0x2788e4),_0x2580cc=squaredDistance(_0x471ee1,_0xe5152);_0x2580cc<_0x8dc504&&(_0x58ba09=_0x50bde2,_0x8dc504=_0x2580cc,_0x15e55f=_0x375e65[_0x33b59a(0x15c)]);});}const _0x1964b6=_0x2ee257();if(_0x1964b6)return _0x1964b6;}if(this[_0x1ebe2e(0x15e)]){for(let _0x55a069=0x0;_0x55a069<_0x369942;++_0x55a069){let _0x55bf38=null;const _0x12ba18=_0x2b7577[_0x55a069];if(_0x12ba18['feature'][_0x1ebe2e(0x144)]()[_0x1ebe2e(0x131)]()===_0x1ebe2e(0x130)){let _0xf1867e=_0x12ba18[_0x1ebe2e(0x15c)][_0x1ebe2e(0x144)]();const _0x301cca=getUserProjection();_0x301cca&&(_0xf1867e=_0xf1867e[_0x1ebe2e(0x12b)]()[_0x1ebe2e(0x13c)](_0x301cca,_0x2788e4)),_0x55bf38=closestOnCircle(_0x471ee1,_0xf1867e);}else{const [_0x4c191f,_0x2d0ba5]=_0x12ba18[_0x1ebe2e(0x16b)];_0x2d0ba5&&(tempSegment[0x0]=fromUserCoordinate(_0x4c191f,_0x2788e4),tempSegment[0x1]=fromUserCoordinate(_0x2d0ba5,_0x2788e4),_0x55bf38=closestOnSegment(_0x471ee1,tempSegment));}if(_0x55bf38){const _0x154eea=squaredDistance(_0x471ee1,_0x55bf38);_0x154eea<_0x8dc504&&(_0x58ba09=toUserCoordinate(_0x55bf38,_0x2788e4),_0xc11255=_0x12ba18[_0x1ebe2e(0x15c)][_0x1ebe2e(0x144)]()[_0x1ebe2e(0x131)]()===_0x1ebe2e(0x130)?null:_0x12ba18[_0x1ebe2e(0x16b)],_0x8dc504=_0x154eea,_0x15e55f=_0x12ba18['feature']);}}const _0x348a8a=_0x2ee257();if(_0x348a8a)return _0x348a8a;}return null;}[_0x222c30(0x149)](_0x21ff6a){const _0x5e9b06=_0x222c30;this[_0x5e9b06(0x14b)](_0x21ff6a,![]),this[_0x5e9b06(0x12e)](_0x21ff6a,![]);}['segmentCircleGeometry_'](_0x47b9db,_0x318710){const _0x364f57=_0x222c30,_0x1a71b8=this[_0x364f57(0x177)]()[_0x364f57(0x127)]()[_0x364f57(0x140)]();let _0x1fe1bb=_0x318710;const _0x132b52=getUserProjection();_0x132b52&&(_0x1fe1bb=_0x1fe1bb[_0x364f57(0x12b)]()['transform'](_0x132b52,_0x1a71b8));const _0x58a79d=fromCircle(_0x1fe1bb);_0x132b52&&_0x58a79d[_0x364f57(0x13c)](_0x1a71b8,_0x132b52);const _0x4cfca7=_0x58a79d['getCoordinates']()[0x0];for(let _0x5c2a3c=0x0,_0x5f173a=_0x4cfca7[_0x364f57(0x158)]-0x1;_0x5c2a3c<_0x5f173a;++_0x5c2a3c){_0x47b9db['push'](_0x4cfca7[_0x364f57(0x164)](_0x5c2a3c,_0x5c2a3c+0x2));}}[_0x222c30(0x151)](_0x5e348c,_0xfdd188){const _0x1d7bb3=_0x222c30,_0x2f52ba=_0xfdd188[_0x1d7bb3(0x139)]();for(let _0x3a5828=0x0;_0x3a5828<_0x2f52ba[_0x1d7bb3(0x158)];++_0x3a5828){const _0x4ff79b=this[_0x1d7bb3(0x161)][_0x2f52ba[_0x3a5828][_0x1d7bb3(0x131)]()];_0x4ff79b&&_0x4ff79b(_0x5e348c,_0x2f52ba[_0x3a5828]);}}[_0x222c30(0x173)](_0x223182,_0x45e4c8){const _0x4bcb34=_0x222c30,_0x5e6080=_0x45e4c8[_0x4bcb34(0x171)]();for(let _0x36c1c3=0x0,_0x588be8=_0x5e6080[_0x4bcb34(0x158)]-0x1;_0x36c1c3<_0x588be8;++_0x36c1c3){_0x223182[_0x4bcb34(0x163)](_0x5e6080[_0x4bcb34(0x164)](_0x36c1c3,_0x36c1c3+0x2));}}[_0x222c30(0x128)](_0x4900cc,_0x4921de){const _0x5ec98b=_0x222c30,_0x3c8247=_0x4921de['getCoordinates']();for(let _0x57b807=0x0,_0x7a7a36=_0x3c8247[_0x5ec98b(0x158)];_0x57b807<_0x7a7a36;++_0x57b807){const _0x1e38f5=_0x3c8247[_0x57b807];for(let _0x428b28=0x0,_0x8c5bd9=_0x1e38f5[_0x5ec98b(0x158)]-0x1;_0x428b28<_0x8c5bd9;++_0x428b28){_0x4900cc[_0x5ec98b(0x163)](_0x1e38f5['slice'](_0x428b28,_0x428b28+0x2));}}}[_0x222c30(0x13e)](_0x1d9a21,_0x2a01d7){const _0x236a0a=_0x222c30;_0x2a01d7[_0x236a0a(0x171)]()['forEach'](_0x23199b=>{const _0x4cf0cd=_0x236a0a;_0x1d9a21[_0x4cf0cd(0x163)]([_0x23199b]);});}[_0x222c30(0x135)](_0x29a69e,_0x5f169d){const _0x2805f0=_0x222c30,_0x341b0d=_0x5f169d['getCoordinates']();for(let _0x3026ed=0x0,_0x4736c9=_0x341b0d['length'];_0x3026ed<_0x4736c9;++_0x3026ed){const _0x5b461c=_0x341b0d[_0x3026ed];for(let _0x59a66a=0x0,_0x3df17e=_0x5b461c['length'];_0x59a66a<_0x3df17e;++_0x59a66a){const _0x229fa9=_0x5b461c[_0x59a66a];for(let _0x3a2909=0x0,_0x2e85f0=_0x229fa9['length']-0x1;_0x3a2909<_0x2e85f0;++_0x3a2909){_0x29a69e[_0x2805f0(0x163)](_0x229fa9[_0x2805f0(0x164)](_0x3a2909,_0x3a2909+0x2));}}}}[_0x222c30(0x15a)](_0xdc9ed7,_0x21877f){const _0x56cbf1=_0x222c30;_0xdc9ed7[_0x56cbf1(0x163)]([_0x21877f[_0x56cbf1(0x171)]()]);}[_0x222c30(0x15f)](_0x3185e2,_0x1c7eab){const _0x152fa2=_0x222c30,_0x115f76=_0x1c7eab[_0x152fa2(0x171)]();for(let _0x29b05c=0x0,_0x58cb59=_0x115f76['length'];_0x29b05c<_0x58cb59;++_0x29b05c){const _0x8d9d85=_0x115f76[_0x29b05c];for(let _0x3a88b5=0x0,_0x3cbea2=_0x8d9d85['length']-0x1;_0x3a88b5<_0x3cbea2;++_0x3a88b5){_0x3185e2['push'](_0x8d9d85[_0x152fa2(0x164)](_0x3a88b5,_0x3a88b5+0x2));}}}}export default Snap;