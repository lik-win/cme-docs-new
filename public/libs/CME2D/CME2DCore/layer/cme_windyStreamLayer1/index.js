function _0x39d4(_0x1881f6,_0x30f177){const _0x172e74=_0x172e();return _0x39d4=function(_0x39d408,_0x424cda){_0x39d408=_0x39d408-0x12a;let _0x546e3d=_0x172e74[_0x39d408];return _0x546e3d;},_0x39d4(_0x1881f6,_0x30f177);}const _0x2062ed=_0x39d4;(function(_0x27ed7d,_0x1ac629){const _0x2fe6f7=_0x39d4,_0x1236e5=_0x27ed7d();while(!![]){try{const _0x2cc823=parseInt(_0x2fe6f7(0x16c))/0x1+-parseInt(_0x2fe6f7(0x15c))/0x2+parseInt(_0x2fe6f7(0x166))/0x3+parseInt(_0x2fe6f7(0x13c))/0x4+-parseInt(_0x2fe6f7(0x168))/0x5*(-parseInt(_0x2fe6f7(0x147))/0x6)+parseInt(_0x2fe6f7(0x131))/0x7*(parseInt(_0x2fe6f7(0x17c))/0x8)+-parseInt(_0x2fe6f7(0x148))/0x9;if(_0x2cc823===_0x1ac629)break;else _0x1236e5['push'](_0x1236e5['shift']());}catch(_0x28a02d){_0x1236e5['push'](_0x1236e5['shift']());}}}(_0x172e,0xd1cdf));import*as _0x37d21e from'./util.js';const drawFrag=_0x2062ed(0x12e),drawVert=_0x2062ed(0x181),quadVert=_0x2062ed(0x15b),screenFrag=_0x2062ed(0x137),updateFrag=_0x2062ed(0x141);export default class WindGL{constructor(_0x5db6bd,_0x130c96){const _0x1e8cd5=_0x2062ed;this['gl']=_0x5db6bd,this[_0x1e8cd5(0x12f)]=_0x130c96['dropRateBump']||0.01,this[_0x1e8cd5(0x13a)]=_0x130c96[_0x1e8cd5(0x13a)]||0.996,this[_0x1e8cd5(0x178)]=_0x130c96[_0x1e8cd5(0x178)]||0.45,this['dropRate']=_0x130c96['dropRate']||0.001,this[_0x1e8cd5(0x15d)]=_0x37d21e[_0x1e8cd5(0x143)](_0x5db6bd,drawVert,drawFrag),this[_0x1e8cd5(0x134)]=_0x37d21e[_0x1e8cd5(0x143)](_0x5db6bd,quadVert,screenFrag),this['updateProgram']=_0x37d21e[_0x1e8cd5(0x143)](_0x5db6bd,quadVert,updateFrag),this[_0x1e8cd5(0x133)]=_0x37d21e[_0x1e8cd5(0x142)](_0x5db6bd,new Float32Array([0x0,0x0,0x1,0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1,0x1]));let _0x413db6=new ArrayBuffer(0x10),_0x4b7ff0=new Float32Array(_0x413db6);console[_0x1e8cd5(0x13d)](_0x1e8cd5(0x155),_0x4b7ff0),this['framebuffer']=_0x5db6bd[_0x1e8cd5(0x139)](),this['resize']();}['resize'](){const _0x3b02e1=_0x2062ed,_0x56ed6a=this['gl'],_0x3d4a70=new Uint8Array(_0x56ed6a[_0x3b02e1(0x161)][_0x3b02e1(0x17e)]*_0x56ed6a['canvas'][_0x3b02e1(0x13b)]*0x4);this['backgroundTexture']=_0x37d21e[_0x3b02e1(0x130)](_0x56ed6a,_0x56ed6a[_0x3b02e1(0x159)],_0x3d4a70,_0x56ed6a['canvas']['width'],_0x56ed6a[_0x3b02e1(0x161)][_0x3b02e1(0x13b)]),this[_0x3b02e1(0x14d)]=_0x37d21e[_0x3b02e1(0x130)](_0x56ed6a,_0x56ed6a['NEAREST'],_0x3d4a70,_0x56ed6a[_0x3b02e1(0x161)][_0x3b02e1(0x17e)],_0x56ed6a['canvas'][_0x3b02e1(0x13b)]);}[_0x2062ed(0x165)](_0x4000b8,_0x2fe654){const _0x24183a=_0x2062ed;this['bounds']=_0x4000b8;const _0x5ceac1=this['gl'];_0x5ceac1['useProgram'](this['drawProgram'][_0x24183a(0x17d)]),_0x5ceac1[_0x24183a(0x145)](this[_0x24183a(0x15d)][_0x24183a(0x156)],_0x4000b8[0x0],_0x4000b8[0x1],_0x4000b8[0x2],_0x4000b8[0x3]),_0x5ceac1[_0x24183a(0x145)](this[_0x24183a(0x15d)][_0x24183a(0x14a)],_0x2fe654[0x0],_0x2fe654[0x1],_0x2fe654[0x2],_0x2fe654[0x3]),_0x5ceac1[_0x24183a(0x163)](this[_0x24183a(0x14e)]['program']),_0x5ceac1[_0x24183a(0x145)](this[_0x24183a(0x14e)][_0x24183a(0x156)],_0x4000b8[0x0],_0x4000b8[0x1],_0x4000b8[0x2],_0x4000b8[0x3]),_0x5ceac1[_0x24183a(0x145)](this[_0x24183a(0x14e)][_0x24183a(0x14a)],_0x2fe654[0x0],_0x2fe654[0x1],_0x2fe654[0x2],_0x2fe654[0x3]);}set[_0x2062ed(0x173)](_0x17bd68){const _0x2afdc1=_0x2062ed,_0x1741ad=this['gl'],_0xa6b712=this[_0x2afdc1(0x138)]=Math[_0x2afdc1(0x15a)](Math['sqrt'](_0x17bd68));this['_numParticles']=_0xa6b712*_0xa6b712;const _0xd927da=new Uint8Array(this['_numParticles']*0x4);for(let _0x262f5e=0x0;_0x262f5e<_0xd927da[_0x2afdc1(0x132)];_0x262f5e++){_0xd927da[_0x262f5e]=Math[_0x2afdc1(0x154)](Math[_0x2afdc1(0x12a)]()*0x100);}this[_0x2afdc1(0x149)]=_0x37d21e[_0x2afdc1(0x130)](_0x1741ad,_0x1741ad[_0x2afdc1(0x159)],_0xd927da,_0xa6b712,_0xa6b712),this[_0x2afdc1(0x135)]=_0x37d21e[_0x2afdc1(0x130)](_0x1741ad,_0x1741ad[_0x2afdc1(0x159)],_0xd927da,_0xa6b712,_0xa6b712);const _0x3a41af=new Float32Array(this['_numParticles']);for(let _0x3de163=0x0;_0x3de163<this[_0x2afdc1(0x16e)];_0x3de163++)_0x3a41af[_0x3de163]=_0x3de163;this['particleIndexBuffer']=_0x37d21e[_0x2afdc1(0x142)](_0x1741ad,_0x3a41af);}get[_0x2062ed(0x173)](){return this['_numParticles'];}[_0x2062ed(0x15f)](_0x4093ec){const _0x19ec9a=_0x2062ed;this[_0x19ec9a(0x179)]=_0x4093ec,this['windTexture']=_0x37d21e[_0x19ec9a(0x130)](this['gl'],this['gl'][_0x19ec9a(0x151)],_0x4093ec['image']);}['draw'](){const _0x512ce6=_0x2062ed,_0x26f152=this['gl'];_0x26f152[_0x512ce6(0x171)](_0x26f152[_0x512ce6(0x140)]),_0x26f152[_0x512ce6(0x171)](_0x26f152['STENCIL_TEST']),_0x37d21e[_0x512ce6(0x170)](_0x26f152,this[_0x512ce6(0x16f)],0x0),_0x37d21e[_0x512ce6(0x170)](_0x26f152,this[_0x512ce6(0x149)],0x1),this[_0x512ce6(0x14c)](),this[_0x512ce6(0x144)]();}['drawScreen'](){const _0x5d369f=_0x2062ed,_0x494376=this['gl'];_0x37d21e[_0x5d369f(0x17b)](_0x494376,this[_0x5d369f(0x176)],this[_0x5d369f(0x14d)]),_0x494376[_0x5d369f(0x175)](0x0,0x0,_0x494376[_0x5d369f(0x161)][_0x5d369f(0x17e)],_0x494376[_0x5d369f(0x161)][_0x5d369f(0x13b)]),this[_0x5d369f(0x158)](this[_0x5d369f(0x17f)],this['fadeOpacity']),this['drawParticles'](),_0x37d21e['bindFramebuffer'](_0x494376,null),_0x494376[_0x5d369f(0x150)](_0x494376['SRC_ALPHA'],_0x494376[_0x5d369f(0x15e)]),this['drawTexture'](this[_0x5d369f(0x14d)],0x1),_0x494376[_0x5d369f(0x171)](_0x494376[_0x5d369f(0x14f)]);const _0x37a9cc=this[_0x5d369f(0x17f)];this[_0x5d369f(0x17f)]=this[_0x5d369f(0x14d)],this[_0x5d369f(0x14d)]=_0x37a9cc;}[_0x2062ed(0x158)](_0x1b2cf0,_0xa0e71){const _0x5d04c3=_0x2062ed,_0x143b90=this['gl'],_0xd6073=this['screenProgram'];_0x143b90['useProgram'](_0xd6073[_0x5d04c3(0x17d)]),_0x37d21e[_0x5d04c3(0x12b)](_0x143b90,this[_0x5d04c3(0x133)],_0xd6073['a_pos'],0x2),_0x37d21e[_0x5d04c3(0x170)](_0x143b90,_0x1b2cf0,0x2),_0x143b90[_0x5d04c3(0x169)](_0xd6073['u_screen'],0x2),_0x143b90[_0x5d04c3(0x174)](_0xd6073[_0x5d04c3(0x157)],_0xa0e71),_0x143b90[_0x5d04c3(0x183)](_0x143b90[_0x5d04c3(0x12d)],0x0,0x6);}[_0x2062ed(0x17a)](){const _0x24c9b9=_0x2062ed,_0xc72d28=this['gl'],_0x31ea18=this['drawProgram'];_0xc72d28[_0x24c9b9(0x163)](_0x31ea18[_0x24c9b9(0x17d)]),_0x37d21e[_0x24c9b9(0x12b)](_0xc72d28,this[_0x24c9b9(0x16d)],_0x31ea18[_0x24c9b9(0x146)],0x1),_0xc72d28[_0x24c9b9(0x169)](_0x31ea18[_0x24c9b9(0x16a)],0x1),_0xc72d28[_0x24c9b9(0x174)](_0x31ea18[_0x24c9b9(0x13f)],this[_0x24c9b9(0x138)]),_0xc72d28[_0x24c9b9(0x169)](_0x31ea18[_0x24c9b9(0x167)],0x0),_0xc72d28['uniform2f'](_0x31ea18[_0x24c9b9(0x153)],this['windData'][_0x24c9b9(0x14b)],this[_0x24c9b9(0x179)][_0x24c9b9(0x136)]),_0xc72d28[_0x24c9b9(0x172)](_0x31ea18[_0x24c9b9(0x16b)],this[_0x24c9b9(0x179)]['uMax'],this[_0x24c9b9(0x179)][_0x24c9b9(0x152)]),_0xc72d28[_0x24c9b9(0x169)](_0x31ea18[_0x24c9b9(0x12c)],this[_0x24c9b9(0x179)][_0x24c9b9(0x12c)]);let _0x473351=this['windData'][_0x24c9b9(0x14a)];_0xc72d28[_0x24c9b9(0x145)](_0x31ea18[_0x24c9b9(0x14a)],_0x473351[0x0],_0x473351[0x1],_0x473351[0x2],_0x473351[0x3]),_0x37d21e['bindTexture'](this['gl'],this['icontexture'],0x2),_0xc72d28[_0x24c9b9(0x169)](_0x31ea18[_0x24c9b9(0x160)],0x2),_0xc72d28[_0x24c9b9(0x183)](_0xc72d28[_0x24c9b9(0x13e)],0x0,this['_numParticles']);}[_0x2062ed(0x144)](){const _0x14659e=_0x2062ed;let _0x50433b=0x10e6;const _0x40b37a=this['gl'];_0x37d21e[_0x14659e(0x17b)](_0x40b37a,this[_0x14659e(0x176)],this[_0x14659e(0x135)]),_0x40b37a[_0x14659e(0x175)](0x0,0x0,this[_0x14659e(0x138)],this[_0x14659e(0x138)]);const _0xce397a=this['updateProgram'];_0x40b37a[_0x14659e(0x163)](_0xce397a[_0x14659e(0x17d)]),_0x37d21e[_0x14659e(0x12b)](_0x40b37a,this['quadBuffer'],_0xce397a[_0x14659e(0x182)],0x2),_0x40b37a['uniform1i'](_0xce397a[_0x14659e(0x167)],0x0),_0x40b37a[_0x14659e(0x169)](_0xce397a[_0x14659e(0x16a)],0x1),_0x40b37a[_0x14659e(0x174)](_0xce397a[_0x14659e(0x164)],Math[_0x14659e(0x12a)]()),_0x40b37a[_0x14659e(0x172)](_0xce397a['u_wind_res'],this[_0x14659e(0x179)][_0x14659e(0x17e)],this[_0x14659e(0x179)][_0x14659e(0x13b)]),_0x40b37a[_0x14659e(0x172)](_0xce397a[_0x14659e(0x153)],this[_0x14659e(0x179)]['uMin'],this[_0x14659e(0x179)][_0x14659e(0x136)]),_0x40b37a[_0x14659e(0x172)](_0xce397a[_0x14659e(0x16b)],this[_0x14659e(0x179)][_0x14659e(0x180)],this[_0x14659e(0x179)][_0x14659e(0x152)]),_0x40b37a['uniform1f'](_0xce397a['u_speed_factor'],this[_0x14659e(0x178)]),_0x40b37a[_0x14659e(0x174)](_0xce397a[_0x14659e(0x177)],this['dropRate']),_0x40b37a['uniform1f'](_0xce397a[_0x14659e(0x162)],this['dropRateBump']),_0x40b37a['uniform1i'](_0xce397a[_0x14659e(0x12c)],this[_0x14659e(0x179)]['projCode']);let _0x307eef=this[_0x14659e(0x179)][_0x14659e(0x14a)];_0x40b37a[_0x14659e(0x145)](_0xce397a[_0x14659e(0x14a)],_0x307eef[0x0],_0x307eef[0x1],_0x307eef[0x2],_0x307eef[0x3]),_0x40b37a[_0x14659e(0x183)](_0x40b37a[_0x14659e(0x12d)],0x0,0x6);const _0x671ebe=this[_0x14659e(0x149)];this['particleStateTexture0']=this[_0x14659e(0x135)],this[_0x14659e(0x135)]=_0x671ebe;}}function _0x172e(){const _0x166d79=['particleStateTexture0','layerExtent','uMin','drawScreen','screenTexture','updateProgram','BLEND','blendFunc','LINEAR','vMax','u_wind_min','floor','floatArray\x20\x20\x20','bounds','u_opacity','drawTexture','NEAREST','ceil','precision\x20mediump\x20float;\x0a\x0aattribute\x20vec2\x20a_pos;\x0a\x0avarying\x20vec2\x20v_tex_pos;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20v_tex_pos\x20=\x20a_pos;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(1.0\x20-\x202.0\x20*\x20a_pos,\x200,\x201);\x0a}','3361364lOdCRi','drawProgram','ONE_MINUS_SRC_ALPHA','setWind','u_icon','canvas','u_drop_rate_bump','useProgram','u_rand_seed','updateBounds','517878BHxbry','u_wind','10JzLnQo','uniform1i','u_particles','u_wind_max','1073051URNYia','particleIndexBuffer','_numParticles','windTexture','bindTexture','disable','uniform2f','numParticles','uniform1f','viewport','framebuffer','u_drop_rate','speedFactor','windData','drawParticles','bindFramebuffer','80vcoBjy','program','width','backgroundTexture','uMax','precision\x20mediump\x20float;\x0aattribute\x20float\x20a_index;\x0auniform\x20sampler2D\x20u_particles;\x0auniform\x20float\x20u_particles_res;\x0avarying\x20vec2\x20v_particle_pos;\x0avarying\x20vec2\x20v_webgl_pos;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture2D(u_particles,\x20vec2(fract(a_index\x20/\x20u_particles_res),\x20floor(a_index\x20/\x20u_particles_res)\x20/\x20u_particles_res));\x0a\x20\x20\x20\x20v_particle_pos\x20=\x20vec2(color.r\x20/\x20255.0\x20+\x20color.b,\x20color.g\x20/\x20255.0\x20+\x20color.a);\x0a\x20\x20\x20\x20v_webgl_pos\x20=\x20vec2(2.0\x20*\x20v_particle_pos\x20-\x201.0);\x0a\x20\x20\x20\x20gl_PointSize\x20=\x201.0;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(v_webgl_pos.x,\x20v_webgl_pos.y,\x200,\x201);\x0a}','a_pos','drawArrays','random','bindAttribute','projCode','TRIANGLES','precision\x20mediump\x20float;\x0auniform\x20sampler2D\x20u_wind;\x0avarying\x20vec2\x20v_particle_pos;\x0auniform\x20vec4\x20bounds;\x0auniform\x20int\x20u_projectionType;\x0auniform\x20int\x20projCode;\x0auniform\x20vec4\x20layerExtent;\x0avec2\x20posTouv(vec2\x20pos,\x20vec4\x20bounds)\x20{\x0a\x20\x20\x20\x20float\x20u\x20=\x20bounds.x\x20+\x20(bounds.y\x20-\x20bounds.x)\x20*\x20pos.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20bounds.z\x20+\x20(bounds.w\x20-\x20bounds.z)\x20*\x20pos.y;\x0a\x20\x20\x20\x20vec2\x20uv_pos\x20=\x20vec2(u,\x201.0\x20-\x20v);\x0a\x20\x20\x20\x20return\x20uv_pos;\x0a}\x0aconst\x20float\x20PI\x20=\x203.14159265359;\x0a\x0a//\x20vec2\x20mercatorToWGS84(vec2\x20xy)\x20{\x0a//\x20\x20\x20\x20\x20//\x20float\x20y\x20=\x20radians(180.0\x20-\x20xy.y\x20*\x20360.0);\x0a//\x20\x20\x20\x20\x20//\x20y\x20=\x20360.0\x20/\x20PI\x20*\x20atan(exp(y))\x20-\x2090.0;\x0a//\x20\x20\x20\x20\x20//\x20y\x20=\x20y\x20/\x20-180.0\x20+\x200.5;\x0a//\x20\x20\x20\x20\x20//\x20return\x20vec2(mod(xy.x,\x201.0),\x20y);\x0a//\x20}\x0a\x0a//\x20vec2\x20wgs84ToMercator(vec2\x20xy)\x20{\x0a//\x20\x20\x20\x20\x20float\x20y\x20=\x20-180.0\x20*\x20xy.y\x20+\x2090.0;\x0a//\x20\x20\x20\x20\x20y\x20=\x20(180.0\x20-\x20(180.0\x20/\x20PI\x20*\x20log(tan(PI\x20/\x204.0\x20+\x20y\x20*\x20PI\x20/\x20360.0))))\x20/\x20360.0;\x0a//\x20\x20\x20\x20\x20return\x20vec2(xy.x,\x20y);\x0a//\x20}\x0a\x0avec2\x20mercatorToWGS84(vec2\x20xy)\x20{\x0a\x0a\x20\x20\x20\x20if(projCode==4326){\x0a\x20\x20\x20\x20\x20\x20return\x20vec2(mod(xy.x,\x201.0),\x20xy.y);\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20else\x20if(projCode==3857){\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20float\x20y\x20=\x20radians(180.0\x20-\x20xy.y\x20*\x20360.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20y\x20=\x20360.0\x20/\x20PI\x20*\x20atan(exp(y))\x20-\x2090.0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20y\x20=\x20y\x20/\x20-180.0\x20+\x200.5;\x0a\x20\x20\x20\x20//坐标转换\x20\x20\x204326就采用下面一行代码就行了\x0a\x20\x20\x20\x20\x20return\x20vec2(mod(xy.x,\x201.0),\x20y);\x0a\x20\x20\x20\x20}\x0a}\x0a\x0a\x0a\x20\x20\x20\x20bool\x20isPointInRect(vec2\x20pt,\x20vec4\x20rect)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20return\x20pt.x\x20>=\x20rect.x\x20&&\x20pt.x\x20<=\x20rect.y\x20&&\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pt.y\x20>=\x20rect.z\x20&&\x20pt.y\x20<=\x20rect.w;\x0a\x20\x20\x20\x20}\x0a\x0a//\x20\x20bool\x20isPointInRect(vec2\x20pt,\x20vec4\x20rect)\x20{\x0a//\x20\x20\x20\x20\x20return\x20all(greaterThanEqual(pt,\x20rect.xz))\x20&&\x20all(lessThanEqual(pt,\x20rect.yw));\x0a\x0a//\x20\x20\x20\x20\x20//\x20rect.xy:\x20代表矩形的左下角\x20(minX,\x20minY)，即\x20vec2(rect.x,\x20rect.y)。\x0a//\x20\x20\x20\x20\x20//\x20rect.zw:\x20代表矩形的右上角\x20(maxX,\x20maxY)，即\x20vec2(rect.z,\x20rect.w)。\x0a//\x20\x20\x20\x20\x20//\x20greaterThanEqual(pt,\x20rect.xy):\x20判断点的\x20x\x20和\x20y\x20是否大于或等于矩形的左下角。\x0a//\x20\x20\x20\x20\x20//\x20lessThanEqual(pt,\x20rect.zw):\x20判断点的\x20x\x20和\x20y\x20是否小于或等于矩形的右上角。\x0a//\x20\x20\x20\x20\x20//\x20all():\x20检查所有条件是否为\x20true。\x0a//\x20\x20}\x0a\x0avoid\x20main()\x20{\x0a\x0a\x20\x20\x20\x20\x20vec2\x20uv_pos\x20=\x20posTouv(v_particle_pos,\x20bounds);\x0a\x20\x20\x20\x20\x20//\x20vec2\x20uv_pos\x20=\x20posTouv(v_particle_pos,\x20layerExtent);\x0a\x20\x20\x20\x20\x20\x20vec4\x20pos\x20=\x20texture2D(u_wind,\x20mercatorToWGS84(uv_pos));\x0a\x20\x20\x20\x20\x20\x20\x20vec2\x20pPt=\x20mercatorToWGS84(uv_pos);\x0a\x20\x20\x20\x20\x20\x20\x20pPt.y\x20=\x201.0\x20-\x20pPt.y;\x0a\x0a\x20\x20\x20\x20////[0.6944027777777778,0.9028194444444444,0.5554722222255489,0.8339722111077844]\x0a\x0a\x20\x20\x20\x20\x20\x20\x20if(isPointInRect(pPt,vec4(\x20layerExtent.x,layerExtent.y,layerExtent.z,layerExtent.w))){\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(1.0,\x200.0,\x200.0,\x201.0)\x20*\x20pos.b;\x0a\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20else{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(0.0,\x201.0,\x201.0,\x201.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20discard;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(1.0,\x201.0,\x201.0,\x201.0)\x20*\x20pos.b;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20//丢弃\x20\x20discard\x0a}','dropRateBump','createTexture','831670OymbaJ','length','quadBuffer','screenProgram','particleStateTexture1','vMin','precision\x20mediump\x20float;\x0a\x0auniform\x20sampler2D\x20u_screen;\x0auniform\x20float\x20u_opacity;\x0a\x0avarying\x20vec2\x20v_tex_pos;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture2D(u_screen,\x201.0\x20-\x20v_tex_pos);\x0a\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(floor(255.0\x20*\x20color\x20*\x20u_opacity)\x20/\x20255.0);\x0a}','particleStateResolution','createFramebuffer','fadeOpacity','height','4924724CvPMjI','log','POINTS','u_particles_res','DEPTH_TEST','precision\x20highp\x20float;\x0auniform\x20sampler2D\x20u_particles;\x0auniform\x20sampler2D\x20u_wind;\x0auniform\x20vec2\x20u_wind_res;\x0auniform\x20vec2\x20u_wind_min;\x0auniform\x20vec2\x20u_wind_max;\x0auniform\x20float\x20u_rand_seed;\x0auniform\x20float\x20u_speed_factor;\x0auniform\x20float\x20u_drop_rate;\x0auniform\x20float\x20u_drop_rate_bump;\x0avarying\x20vec2\x20v_tex_pos;\x0auniform\x20vec4\x20bounds;\x0auniform\x20int\x20projCode;\x0auniform\x20vec4\x20layerExtent;\x0a\x0aconst\x20vec3\x20rand_constants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0afloat\x20rand(const\x20vec2\x20co)\x20{\x0a\x20\x20\x20\x20float\x20t\x20=\x20dot(rand_constants.xy,\x20co);\x0a\x20\x20\x20\x20return\x20fract(sin(t)\x20*\x20(rand_constants.z\x20+\x20t));\x0a}\x0a\x0avec2\x20lookup_wind(const\x20vec2\x20uv)\x20{\x0a\x20\x20\x20\x20vec2\x20px\x20=\x201.0\x20/\x20u_wind_res;\x0a\x20\x20\x20\x20vec2\x20vc\x20=\x20(floor(uv\x20*\x20u_wind_res))\x20*\x20px;\x0a\x20\x20\x20\x20vec2\x20f\x20=\x20fract(uv\x20*\x20u_wind_res);\x0a\x0a\x20\x20\x20\x20vec2\x20tl\x20=\x20texture2D(u_wind,\x20vc).rg;\x0a\x20\x20\x20\x20vec2\x20tr\x20=\x20texture2D(u_wind,\x20vc\x20+\x20vec2(px.x,\x200)).rg;\x0a\x20\x20\x20\x20vec2\x20bl\x20=\x20texture2D(u_wind,\x20vc\x20+\x20vec2(0,\x20px.y)).rg;\x0a\x20\x20\x20\x20vec2\x20br\x20=\x20texture2D(u_wind,\x20vc\x20+\x20px).rg;\x0a\x20\x20\x20\x20return\x20mix(mix(tl,\x20tr,\x20f.x),\x20mix(bl,\x20br,\x20f.x),\x20f.y);\x0a}\x0a\x0avec2\x20posTouv(vec2\x20pos)\x20{\x0a\x20\x20\x20\x20float\x20u\x20=\x20bounds.x\x20+\x20(bounds.y\x20-\x20bounds.x)\x20*\x20pos.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20bounds.z\x20+\x20(bounds.w\x20-\x20bounds.z)\x20*\x20pos.y;\x0a\x20\x20\x20\x20vec2\x20uv_pos\x20=\x20vec2(u,\x201.0\x20-\x20v);\x0a\x20\x20\x20\x20return\x20uv_pos;\x0a}\x0a\x0avec2\x20uvTopos(vec2\x20uv)\x20{\x0a\x20\x20\x20\x20float\x20x\x20=\x20(uv.x\x20-\x20bounds.x)\x20/\x20(bounds.y\x20-\x20bounds.x);\x0a\x20\x20\x20\x20float\x20y\x20=\x20(uv.y\x20-\x20bounds.z)\x20/\x20(bounds.w\x20-\x20bounds.z);\x0a\x20\x20\x20\x20vec2\x20pos\x20=\x20vec2(x,\x20y);\x0a\x20\x20\x20\x20return\x20pos;\x0a}\x0aconst\x20float\x20PI\x20=\x203.14159265359;\x0a\x0avec2\x20mercatorToWGS84(vec2\x20xy)\x20{\x0a\x20\x20\x20\x20if(projCode==4326){\x0a\x20\x20\x20\x20\x20\x20return\x20vec2(mod(xy.x,\x201.0),\x20xy.y);\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20else\x20if(projCode==3857){\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20float\x20y\x20=\x20radians(180.0\x20-\x20xy.y\x20*\x20360.0);\x0a\x20\x20\x20\x20\x20\x20\x20\x20y\x20=\x20360.0\x20/\x20PI\x20*\x20atan(exp(y))\x20-\x2090.0;\x0a\x20\x20\x20\x20\x20\x20\x20\x20y\x20=\x20y\x20/\x20-180.0\x20+\x200.5;\x0a\x20\x20\x20\x20//坐标转换\x20\x20\x204326就采用下面一行代码就行了\x0a\x20\x20\x20\x20\x20return\x20vec2(mod(xy.x,\x201.0),\x20y);\x0a\x20\x20\x20\x20}\x0a\x20\x0a}\x0avec2\x20wgs84ToMercator(vec2\x20xy)\x20{\x0a\x20\x20\x20\x20float\x20y\x20=\x20-180.0\x20*\x20xy.y\x20+\x2090.0;\x0a\x20\x20\x20\x20y\x20=\x20(180.0\x20-\x20(180.0\x20/\x20PI\x20*\x20log(tan(PI\x20/\x204.0\x20+\x20y\x20*\x20PI\x20/\x20360.0))))\x20/\x20360.0;\x0a\x20\x20\x20\x20return\x20vec2(xy.x,\x20y);\x0a}\x0a\x0abool\x20isPointInRect(vec2\x20pt,\x20vec4\x20rect)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20return\x20pt.x\x20>=\x20rect.x\x20&&\x20pt.x\x20<=\x20rect.y\x20&&\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pt.y\x20>=\x20rect.z\x20&&\x20pt.y\x20<=\x20rect.w;\x0a\x20\x20\x20\x20}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20color\x20=\x20texture2D(u_particles,\x20v_tex_pos);\x0a\x20\x20\x20\x20vec2\x20pos\x20=\x20vec2(color.r\x20/\x20255.0\x20+\x20color.b,\x20color.g\x20/\x20255.0\x20+\x20color.a);\x0a\x20\x20\x20\x20vec2\x20uv_pos\x20=\x20posTouv(pos);\x0a\x20\x20\x20\x20\x20vec2\x20pPt=\x20mercatorToWGS84(uv_pos);\x0a\x20\x20\x20\x20vec2\x20velocity\x20=\x20mix(u_wind_min,\x20u_wind_max,\x20lookup_wind(mercatorToWGS84(uv_pos)));\x0a\x20\x20\x20\x20float\x20speed_t\x20=\x20length(velocity)\x20/\x20length(u_wind_max);\x0a\x0a\x20\x20\x20\x20float\x20distortion\x20=\x20cos(radians(pos.y\x20*\x20180.0\x20-\x2090.0));\x0a\x0a\x20\x20\x20\x20vec2\x20offset\x20=\x20vec2(velocity.x,\x20velocity.y)\x20*\x200.0001\x20*\x20u_speed_factor;\x0a\x0a\x20\x20\x20\x20pos\x20=\x20fract(1.0\x20+\x20pos\x20+\x20offset);\x0a\x20\x20\x20\x20vec2\x20seed\x20=\x20(pos\x20+\x20v_tex_pos)\x20*\x20u_rand_seed;\x0a\x0a\x20\x20\x20\x20float\x20drop_rate\x20=\x20u_drop_rate\x20+\x20speed_t\x20*\x20u_drop_rate_bump;\x0a\x20\x20\x20\x20float\x20drop\x20=\x20step(1.0\x20-\x20drop_rate,\x20rand(seed));\x0a\x0a\x20\x20\x20\x20vec2\x20random_pos\x20=\x20vec2(rand(seed\x20+\x201.3),\x20rand(seed\x20+\x202.1));\x0a\x0a\x20\x20\x20\x20pos\x20=\x20mix(pos,\x20random_pos,\x20drop);\x0a\x0a\x20\x20\x20\x20//\x20\x20if(isPointInRect(pPt,vec4(\x20layerExtent.x,layerExtent.y,layerExtent.z,layerExtent.w))){\x0a\x20\x20\x20\x20//\x20\x20\x20\x20\x20//\x20\x20if(isPointInRect(uv_pos,vec4(0.6944,0.90282,0.55547,0.83397))){\x0a\x20\x20\x20\x20//\x20\x20\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(fract(pos\x20*\x20255.0),\x20floor(pos\x20*\x20255.0)\x20/\x20255.0);\x0a\x20\x20\x20\x20//\x20\x20\x20\x20}\x0a\x20\x20\x20\x20//\x20\x20\x20\x20\x20else{\x0a\x20\x20\x20\x20//\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20\x20\x20gl_FragColor\x20=\x20vec4(1.0,\x201.0,\x201.0,\x201.0)\x20*\x200.0;\x0a\x20\x20\x20\x20//\x20\x20\x20\x20\x20discard;\x0a\x20\x20\x20\x20//\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20gl_FragColor\x20=\x20vec4(fract(pos\x20*\x20255.0),\x20floor(pos\x20*\x20255.0)\x20/\x20255.0);\x0a}','createBuffer','createProgram','updateParticles','uniform4f','a_index','2335050lhWsiN','17129403oqKZEZ'];_0x172e=function(){return _0x166d79;};return _0x172e();}