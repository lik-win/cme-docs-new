const _0x2efa4a=_0x1d3c;(function(_0x3ff74b,_0x4f2aa8){const _0x1bd109=_0x1d3c,_0x1c1950=_0x3ff74b();while(!![]){try{const _0x3bd319=-parseInt(_0x1bd109(0xeb))/0x1+parseInt(_0x1bd109(0xea))/0x2*(parseInt(_0x1bd109(0x121))/0x3)+-parseInt(_0x1bd109(0x127))/0x4+-parseInt(_0x1bd109(0xfb))/0x5+parseInt(_0x1bd109(0x10e))/0x6*(-parseInt(_0x1bd109(0xfd))/0x7)+-parseInt(_0x1bd109(0x111))/0x8*(parseInt(_0x1bd109(0x139))/0x9)+-parseInt(_0x1bd109(0x11e))/0xa*(-parseInt(_0x1bd109(0x114))/0xb);if(_0x3bd319===_0x4f2aa8)break;else _0x1c1950['push'](_0x1c1950['shift']());}catch(_0x34bdc3){_0x1c1950['push'](_0x1c1950['shift']());}}}(_0x5acf,0xbb358));import{ERROR_THRESHOLD}from'./common.js';function _0x5acf(){const _0x5c1e03=['gutter','3vpYzZr','sourceTileGrid_','getTileSize','targetProj','wrappedTileCoord','getContext','3559604RxoHEc','round','resolve','sourceProj','unlistenSources_','buffer','getTriangles','errorThreshold','slice','clipExtent_','CHANGE','getState','pixelRatio_','getExtent','triangulation_','sourceTiles_','minX','offset','18FYmHpL','getTileCoordExtent','number','calculateSourceExtent','state','2650006EPveKI','997635IBTZVQ','canWrapX','clipExtent','width','ceil','createImageData','canvas','sourcesListenerKeys_','load','minY','reprojError_','IDLE','targetTileGrid_','LOADED','getSize','getImageData','7460385SpgvjQ','ERROR','8058757eERHtU','sourceTileGrid','reprojData_','interpolate','putImageData','bind','maxX','bytesPerPixel','BYTES_PER_ELEMENT','gutter_','wrappedTileCoord_','data','floor','tileCoord','maxY','push','reprojSize_','6evhlnW','EMPTY','length','4699328JOdZRi','tile','pixelRatio','413303LTuQrK','LOADING','getResolution','getData','sourceZ_','changed','pixelSize','height','forEach','reproject_','1370aZPhzU','targetTileGrid'];_0x5acf=function(){return _0x5c1e03;};return _0x5acf();}import _0x3e3850,{asArrayLike,asImageLike,toArray}from'../DataTile.js';import _0x4d66d9 from'../events/EventType.js';import _0x22d283 from'../TileState.js';import _0x3e75f8 from'./Triangulation.js';import{calculateSourceExtentResolution,canvasPool,render as _0x9b4e81}from'../reproj.js';import{clamp}from'../math.js';import{createCanvasContext2D,releaseCanvas}from'../dom.js';import{getArea,getIntersection,getWidth,wrapAndSliceX}from'../extent.js';import{listen,unlistenByKey}from'../events.js';function _0x1d3c(_0x49e857,_0x2f556e){const _0x5acfd3=_0x5acf();return _0x1d3c=function(_0x1d3c81,_0x2b432d){_0x1d3c81=_0x1d3c81-0xea;let _0xcf435e=_0x5acfd3[_0x1d3c81];return _0xcf435e;},_0x1d3c(_0x49e857,_0x2f556e);}class ReprojDataTile extends _0x3e3850{constructor(_0x3fd348){const _0x3f8e4f=_0x1d3c;super({'tileCoord':_0x3fd348[_0x3f8e4f(0x10a)],'loader':()=>Promise[_0x3f8e4f(0x129)](new Uint8ClampedArray(0x4)),'interpolate':_0x3fd348[_0x3f8e4f(0x100)],'transition':_0x3fd348['transition']}),this[_0x3f8e4f(0x133)]=_0x3fd348[_0x3f8e4f(0x113)],this[_0x3f8e4f(0x106)]=_0x3fd348[_0x3f8e4f(0x120)],this[_0x3f8e4f(0xff)]=null,this[_0x3f8e4f(0xf5)]=null,this['reprojSize_']=undefined,this[_0x3f8e4f(0x122)]=_0x3fd348[_0x3f8e4f(0xfe)],this[_0x3f8e4f(0xf7)]=_0x3fd348[_0x3f8e4f(0x11f)],this['wrappedTileCoord_']=_0x3fd348[_0x3f8e4f(0x125)]||_0x3fd348['tileCoord'],this[_0x3f8e4f(0x136)]=[],this[_0x3f8e4f(0xf2)]=null,this[_0x3f8e4f(0x118)]=0x0;const _0x283d29=_0x3fd348[_0x3f8e4f(0x12a)],_0xce0217=_0x283d29['getExtent'](),_0x5f0412=_0x3fd348['sourceTileGrid']['getExtent']();this[_0x3f8e4f(0x130)]=_0x283d29['canWrapX']()?_0x5f0412?getIntersection(_0xce0217,_0x5f0412):_0xce0217:_0x5f0412;const _0x3412ec=this[_0x3f8e4f(0xf7)][_0x3f8e4f(0x13a)](this[_0x3f8e4f(0x107)]),_0x3d27a6=this[_0x3f8e4f(0xf7)][_0x3f8e4f(0x134)]();let _0x306b1f=this[_0x3f8e4f(0x122)][_0x3f8e4f(0x134)]();const _0x39e72e=_0x3d27a6?getIntersection(_0x3412ec,_0x3d27a6):_0x3412ec;if(getArea(_0x39e72e)===0x0){this[_0x3f8e4f(0x13d)]=_0x22d283[_0x3f8e4f(0x10f)];return;}_0xce0217&&(!_0x306b1f?_0x306b1f=_0xce0217:_0x306b1f=getIntersection(_0x306b1f,_0xce0217));const _0x510842=this[_0x3f8e4f(0xf7)][_0x3f8e4f(0x116)](this[_0x3f8e4f(0x107)][0x0]),_0x500900=_0x3fd348[_0x3f8e4f(0x124)],_0x4775ae=calculateSourceExtentResolution(_0x283d29,_0x500900,_0x39e72e,_0x510842);if(!isFinite(_0x4775ae)||_0x4775ae<=0x0){this['state']=_0x22d283[_0x3f8e4f(0x10f)];return;}const _0xe699f9=_0x3fd348['errorThreshold']!==undefined?_0x3fd348[_0x3f8e4f(0x12e)]:ERROR_THRESHOLD;this[_0x3f8e4f(0x135)]=new _0x3e75f8(_0x283d29,_0x500900,_0x39e72e,_0x306b1f,_0x4775ae*_0xe699f9,_0x510842);if(this[_0x3f8e4f(0x135)][_0x3f8e4f(0x12d)]()[_0x3f8e4f(0x110)]===0x0){this[_0x3f8e4f(0x13d)]=_0x22d283['EMPTY'];return;}this[_0x3f8e4f(0x118)]=this['sourceTileGrid_']['getZForResolution'](_0x4775ae);let _0x24c3ab=this[_0x3f8e4f(0x135)][_0x3f8e4f(0x13c)]();_0x306b1f&&(_0x283d29[_0x3f8e4f(0xec)]()?(_0x24c3ab[0x1]=clamp(_0x24c3ab[0x1],_0x306b1f[0x1],_0x306b1f[0x3]),_0x24c3ab[0x3]=clamp(_0x24c3ab[0x3],_0x306b1f[0x1],_0x306b1f[0x3])):_0x24c3ab=getIntersection(_0x24c3ab,_0x306b1f));if(!getArea(_0x24c3ab))this[_0x3f8e4f(0x13d)]=_0x22d283['EMPTY'];else{let _0x5347ac=0x0,_0x549a8f=0x0;_0x283d29[_0x3f8e4f(0xec)]()&&(_0x5347ac=getWidth(_0xce0217),_0x549a8f=Math[_0x3f8e4f(0x109)]((_0x24c3ab[0x0]-_0xce0217[0x0])/_0x5347ac));const _0x48985f=wrapAndSliceX(_0x24c3ab[_0x3f8e4f(0x12f)](),_0x283d29,!![]);_0x48985f[_0x3f8e4f(0x11c)](_0x38f43b=>{const _0x345a64=_0x3f8e4f,_0x3c92dc=this[_0x345a64(0x122)]['getTileRangeForExtentAndZ'](_0x38f43b,this['sourceZ_']),_0x8975fd=_0x3fd348['getTileFunction'];for(let _0x3c563e=_0x3c92dc[_0x345a64(0x137)];_0x3c563e<=_0x3c92dc[_0x345a64(0x103)];_0x3c563e++){for(let _0x5914d0=_0x3c92dc[_0x345a64(0xf4)];_0x5914d0<=_0x3c92dc[_0x345a64(0x10b)];_0x5914d0++){const _0x500fc7=_0x8975fd(this[_0x345a64(0x118)],_0x3c563e,_0x5914d0,this[_0x345a64(0x133)]);if(_0x500fc7){const _0x5c9622=_0x549a8f*_0x5347ac;this[_0x345a64(0x136)]['push']({'tile':_0x500fc7,'offset':_0x5c9622});}}}++_0x549a8f;}),this[_0x3f8e4f(0x136)][_0x3f8e4f(0x110)]===0x0&&(this[_0x3f8e4f(0x13d)]=_0x22d283[_0x3f8e4f(0x10f)]);}}[_0x2efa4a(0xf9)](){const _0x78cc8f=_0x2efa4a;return this[_0x78cc8f(0x10d)];}[_0x2efa4a(0x117)](){return this['reprojData_'];}['getError'](){const _0x3e84c0=_0x2efa4a;return this[_0x3e84c0(0xf5)];}[_0x2efa4a(0x11d)](){const _0x1d28d8=_0x2efa4a,_0x43f22d=[];let _0x5cb884=![];this[_0x1d28d8(0x136)][_0x1d28d8(0x11c)](_0x16f0fa=>{const _0x24f235=_0x1d28d8,_0x4712e5=_0x16f0fa[_0x24f235(0x112)];if(!_0x4712e5||_0x4712e5['getState']()!==_0x22d283[_0x24f235(0xf8)])return;const _0x1c6c42=_0x4712e5[_0x24f235(0xf9)](),_0x576406=this[_0x24f235(0x106)];let _0x48e3b8;const _0x36a0c7=asArrayLike(_0x4712e5[_0x24f235(0x117)]());_0x36a0c7?_0x48e3b8=_0x36a0c7:(_0x5cb884=!![],_0x48e3b8=toArray(asImageLike(_0x4712e5[_0x24f235(0x117)]())));const _0x191e2a=[_0x1c6c42[0x0]+0x2*_0x576406,_0x1c6c42[0x1]+0x2*_0x576406],_0x457549=_0x48e3b8 instanceof Float32Array,_0x48758d=_0x191e2a[0x0]*_0x191e2a[0x1],_0x1be042=_0x457549?Float32Array:Uint8ClampedArray,_0x29dad0=new _0x1be042(_0x48e3b8[_0x24f235(0x12c)]),_0x2cb53b=_0x1be042[_0x24f235(0x105)],_0x48c4c1=_0x2cb53b*_0x29dad0[_0x24f235(0x110)]/_0x48758d,_0xe4050f=_0x29dad0['byteLength']/_0x191e2a[0x1],_0x2798c4=Math['floor'](_0xe4050f/_0x2cb53b/_0x191e2a[0x0]),_0x2cddcd=_0x48758d*_0x2798c4;let _0x4f76a8=_0x29dad0;if(_0x29dad0[_0x24f235(0x110)]!==_0x2cddcd){_0x4f76a8=new _0x1be042(_0x2cddcd);let _0x4cd211=0x0,_0x89b850=0x0;const _0x89a896=_0x191e2a[0x0]*_0x2798c4;for(let _0xa55eec=0x0;_0xa55eec<_0x191e2a[0x1];++_0xa55eec){for(let _0x1ace8f=0x0;_0x1ace8f<_0x89a896;++_0x1ace8f){_0x4f76a8[_0x4cd211++]=_0x29dad0[_0x89b850+_0x1ace8f];}_0x89b850+=_0xe4050f/_0x2cb53b;}}const _0x510ba0=this[_0x24f235(0x122)]['getTileCoordExtent'](_0x4712e5[_0x24f235(0x10a)]);_0x510ba0[0x0]+=_0x16f0fa[_0x24f235(0x138)],_0x510ba0[0x2]+=_0x16f0fa[_0x24f235(0x138)];const _0x328fdb=this['clipExtent_']?.[_0x24f235(0x12f)]();_0x328fdb&&(_0x328fdb[0x0]+=_0x16f0fa['offset'],_0x328fdb[0x2]+=_0x16f0fa[_0x24f235(0x138)]),_0x43f22d[_0x24f235(0x10c)]({'extent':_0x510ba0,'clipExtent':_0x328fdb,'data':new Uint8ClampedArray(_0x4f76a8['buffer']),'dataType':_0x1be042,'bytesPerPixel':_0x48c4c1,'pixelSize':_0x191e2a});}),this[_0x1d28d8(0x136)]['length']=0x0;if(_0x43f22d[_0x1d28d8(0x110)]===0x0){this[_0x1d28d8(0x13d)]=_0x22d283[_0x1d28d8(0xfc)],this[_0x1d28d8(0x119)]();return;}const _0x504e89=this['wrappedTileCoord_'][0x0],_0x4c3c7b=this[_0x1d28d8(0xf7)][_0x1d28d8(0x123)](_0x504e89),_0x354bb2=typeof _0x4c3c7b==='number'?_0x4c3c7b:_0x4c3c7b[0x0],_0x58ceaa=typeof _0x4c3c7b===_0x1d28d8(0x13b)?_0x4c3c7b:_0x4c3c7b[0x1],_0x4c825a=this[_0x1d28d8(0xf7)][_0x1d28d8(0x116)](_0x504e89),_0x18b0ba=this[_0x1d28d8(0x122)][_0x1d28d8(0x116)](this[_0x1d28d8(0x118)]),_0x3994be=this['targetTileGrid_'][_0x1d28d8(0x13a)](this[_0x1d28d8(0x107)]);let _0x929b91,_0xb5cebe;const _0x3bbfc6=_0x43f22d[0x0][_0x1d28d8(0x104)],_0x709fe0=Math[_0x1d28d8(0xef)](_0x3bbfc6/0x3);for(let _0x237922=_0x709fe0-0x1;_0x237922>=0x0;--_0x237922){const _0x341849=[];for(let _0xc4ecb9=0x0,_0x1e8b9c=_0x43f22d[_0x1d28d8(0x110)];_0xc4ecb9<_0x1e8b9c;++_0xc4ecb9){const _0x591735=_0x43f22d[_0xc4ecb9],_0x2bd456=_0x591735['data'],_0x19816d=_0x591735[_0x1d28d8(0x11a)],_0x2447d8=_0x19816d[0x0],_0x3ea750=_0x19816d[0x1],_0x61a0bf=createCanvasContext2D(_0x2447d8,_0x3ea750,canvasPool),_0x258e01=_0x61a0bf[_0x1d28d8(0xf0)](_0x2447d8,_0x3ea750),_0x220222=_0x258e01['data'];let _0x229e6e=_0x237922*0x3;for(let _0xe4815e=0x0,_0x2876d5=_0x220222[_0x1d28d8(0x110)];_0xe4815e<_0x2876d5;_0xe4815e+=0x4){_0x220222[_0xe4815e]=_0x2bd456[_0x229e6e],_0x220222[_0xe4815e+0x1]=_0x2bd456[_0x229e6e+0x1],_0x220222[_0xe4815e+0x2]=_0x2bd456[_0x229e6e+0x2],_0x220222[_0xe4815e+0x3]=0xff,_0x229e6e+=_0x3bbfc6;}_0x61a0bf['putImageData'](_0x258e01,0x0,0x0),_0x341849[_0x1d28d8(0x10c)]({'extent':_0x591735['extent'],'clipExtent':_0x591735[_0x1d28d8(0xed)],'image':_0x61a0bf[_0x1d28d8(0xf1)]});}const _0x436d76=_0x9b4e81(_0x354bb2,_0x58ceaa,this[_0x1d28d8(0x133)],_0x18b0ba,this[_0x1d28d8(0x122)][_0x1d28d8(0x134)](),_0x4c825a,_0x3994be,this['triangulation_'],_0x341849,this[_0x1d28d8(0x106)],![],![],![]);for(let _0xcf9e48=0x0,_0x18753b=_0x341849['length'];_0xcf9e48<_0x18753b;++_0xcf9e48){const _0x579c94=_0x341849[_0xcf9e48]['image'],_0x49d6e4=_0x579c94['getContext']('2d');releaseCanvas(_0x49d6e4),canvasPool['push'](_0x49d6e4[_0x1d28d8(0xf1)]);}const _0x5ab7b9=_0x436d76[_0x1d28d8(0x126)]('2d'),_0x1ff178=_0x5ab7b9[_0x1d28d8(0xfa)](0x0,0x0,_0x436d76['width'],_0x436d76[_0x1d28d8(0x11b)]);releaseCanvas(_0x5ab7b9),canvasPool[_0x1d28d8(0x10c)](_0x436d76);!_0x929b91&&(_0xb5cebe=new Uint8ClampedArray(_0x3bbfc6*_0x1ff178[_0x1d28d8(0xee)]*_0x1ff178[_0x1d28d8(0x11b)]),_0x929b91=new _0x43f22d[0x0]['dataType'](_0xb5cebe['buffer']));const _0x588398=_0x1ff178[_0x1d28d8(0x108)];let _0x69f9d2=_0x237922*0x3;for(let _0x4860e7=0x0,_0xa99724=_0x588398[_0x1d28d8(0x110)];_0x4860e7<_0xa99724;_0x4860e7+=0x4){_0x588398[_0x4860e7+0x3]===0xff?(_0xb5cebe[_0x69f9d2]=_0x588398[_0x4860e7],_0xb5cebe[_0x69f9d2+0x1]=_0x588398[_0x4860e7+0x1],_0xb5cebe[_0x69f9d2+0x2]=_0x588398[_0x4860e7+0x2]):(_0xb5cebe[_0x69f9d2]=0x0,_0xb5cebe[_0x69f9d2+0x1]=0x0,_0xb5cebe[_0x69f9d2+0x2]=0x0),_0x69f9d2+=_0x3bbfc6;}}if(_0x5cb884){const _0x5e3947=createCanvasContext2D(_0x354bb2,_0x58ceaa),_0x2ca06a=new ImageData(_0x929b91,_0x354bb2);_0x5e3947[_0x1d28d8(0x101)](_0x2ca06a,0x0,0x0),this[_0x1d28d8(0xff)]=_0x5e3947[_0x1d28d8(0xf1)];}else this['reprojData_']=_0x929b91;this[_0x1d28d8(0x10d)]=[Math['round'](_0x354bb2*this['pixelRatio_']),Math[_0x1d28d8(0x128)](_0x58ceaa*this[_0x1d28d8(0x133)])],this[_0x1d28d8(0x13d)]=_0x22d283[_0x1d28d8(0xf8)],this['changed']();}[_0x2efa4a(0xf3)](){const _0x468266=_0x2efa4a;if(this[_0x468266(0x13d)]!==_0x22d283[_0x468266(0xf6)]&&this[_0x468266(0x13d)]!==_0x22d283[_0x468266(0xfc)])return;this[_0x468266(0x13d)]=_0x22d283[_0x468266(0x115)],this[_0x468266(0x119)]();let _0x54993b=0x0;this[_0x468266(0xf2)]=[],this[_0x468266(0x136)]['forEach'](({tile:_0x3b347f})=>{const _0x318392=_0x468266,_0x39e69a=_0x3b347f[_0x318392(0x132)]();if(_0x39e69a!==_0x22d283[_0x318392(0xf6)]&&_0x39e69a!==_0x22d283[_0x318392(0x115)])return;_0x54993b++;const _0x53e7f6=listen(_0x3b347f,_0x4d66d9[_0x318392(0x131)],()=>{const _0x1c0cc0=_0x318392,_0x570655=_0x3b347f['getState']();(_0x570655==_0x22d283['LOADED']||_0x570655==_0x22d283[_0x1c0cc0(0xfc)]||_0x570655==_0x22d283[_0x1c0cc0(0x10f)])&&(unlistenByKey(_0x53e7f6),_0x54993b--,_0x54993b===0x0&&(this[_0x1c0cc0(0x12b)](),this['reproject_']()));});this[_0x318392(0xf2)][_0x318392(0x10c)](_0x53e7f6);}),_0x54993b===0x0?setTimeout(this[_0x468266(0x11d)][_0x468266(0x102)](this),0x0):this[_0x468266(0x136)]['forEach'](function({tile:_0x525c65}){const _0x4ac4d6=_0x468266,_0x25514a=_0x525c65['getState']();_0x25514a==_0x22d283['IDLE']&&_0x525c65[_0x4ac4d6(0xf3)]();});}[_0x2efa4a(0x12b)](){const _0x2f34aa=_0x2efa4a;this[_0x2f34aa(0xf2)][_0x2f34aa(0x11c)](unlistenByKey),this['sourcesListenerKeys_']=null;}}export default ReprojDataTile;