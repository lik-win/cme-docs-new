const _0x2271e9=_0x362f;(function(_0xff391c,_0x5c18dd){const _0xf13d76=_0x362f,_0x333dbe=_0xff391c();while(!![]){try{const _0x4634ee=parseInt(_0xf13d76(0xd4))/0x1*(parseInt(_0xf13d76(0xe4))/0x2)+parseInt(_0xf13d76(0xf7))/0x3*(-parseInt(_0xf13d76(0x122))/0x4)+parseInt(_0xf13d76(0xe7))/0x5*(-parseInt(_0xf13d76(0xca))/0x6)+-parseInt(_0xf13d76(0xfe))/0x7+parseInt(_0xf13d76(0x10a))/0x8+-parseInt(_0xf13d76(0x10c))/0x9*(-parseInt(_0xf13d76(0x105))/0xa)+parseInt(_0xf13d76(0x12f))/0xb*(-parseInt(_0xf13d76(0x124))/0xc);if(_0x4634ee===_0x5c18dd)break;else _0x333dbe['push'](_0x333dbe['shift']());}catch(_0x1bba98){_0x333dbe['push'](_0x333dbe['shift']());}}}(_0x3b36,0x8b7f6));import _0x2dbfeb from'../../layer/BaseVector.js';import _0x4841b3 from'../../source/VectorEventType.js';function _0x3b36(){const _0x1e258c=['CHANGEFEATURE','hitDetectionEnabled_','handleSourceFeatureClear_','403326AkVCjA','a_featureUid','customAttributes','applyHitDetectionUniform','viewHints','floor','renderWorlds','10ykpMVF','finalizeDraw','extent','featureCount_','viewState','7332120mcOQDQ','fragmentShader_','4322736YECaFn','ANIMATING','preRender','getGL','verticesBuffer_','vertexBuffer','sourceListenKeys_','a_prop_','changed','getLayer','lastSentId','terminate','a_prop_hitColor','invertRenderTransform_','featureCache_','makeProjectionTransform','vertexShader_','FLOAT','program_','handleSourceFeatureDelete_','disposeInternal','message','394712SiCRTk','CLEAR','1799160PFKxbJ','useProgram','getFeatureByUid','forEach','projection','applyUniforms','projectionTransform','readPixel','clearCachedData','handleSourceFeatureChanged_','flushBufferData','33cWrnUe','getSource','drawElements','buffer','push','size','postProcesses','toString','Point','resolution','hitDetectionEnabled','getSize','renderTransform_','1576464OovTST','data','dispatchPreComposeEvent','feature','getRevision','prepareDraw','getProperties','attributes','getProgram','`forEachFeatureAtCoordinate`\x20cannot\x20be\x20used\x20on\x20a\x20WebGL\x20layer\x20if\x20the\x20hit\x20detection\x20logic\x20has\x20been\x20disabled\x20using\x20the\x20`disableHitDetection:\x20true`\x20option.','343391HfUmSI','prepareDrawToRenderTarget','sourceRevision_','hitRenderTarget_','handleSourceFeatureAdded_','worker_','getCanvas','a_position','indexBuffer','type','postRender','ADDFEATURE','getFlatCoordinates','forEachFeatureAtCoordinate','fromArrayBuffer','renderInstructions_','6nuXGlR','a_index','previousExtent_','5MotNZP','geometry','INTERACTING','getRenderBuffer','length','fragmentShader','getArray','indicesBuffer_','GENERATE_POINT_BUFFERS','renderFrame','getGeometry','currentTransform_','bindBuffer','helper','REMOVEFEATURE','name','33kiCTvF','prepareFrameInternal','rebuildBuffers_','ready'];_0x3b36=function(){return _0x1e258c;};return _0x3b36();}import _0x259f6a from'../../ViewHint.js';import _0x41847f from'../../webgl/Buffer.js';import _0x3cbb3b from'./Layer.js';import _0x430b47 from'../../webgl/RenderTarget.js';import{ARRAY_BUFFER,DYNAMIC_DRAW,ELEMENT_ARRAY_BUFFER}from'../../webgl.js';import{AttributeType,DefaultUniform}from'../../webgl/Helper.js';import{WebGLWorkerMessageType}from'../../render/webgl/constants.js';import{apply as _0x544dc4,create as _0x2426b5,makeInverse as _0x55e97a,multiply as _0x46502c,translate as _0x116ff3}from'../../transform.js';import{assert}from'../../asserts.js';import{buffer,createEmpty,equals}from'../../extent.js';import{colorDecodeId,colorEncodeId}from'../../render/webgl/utils.js';function _0x362f(_0x51bee0,_0x50d4f6){const _0x3b36c3=_0x3b36();return _0x362f=function(_0x362fb1,_0x35682e){_0x362fb1=_0x362fb1-0xc3;let _0x16a388=_0x3b36c3[_0x362fb1];return _0x16a388;},_0x362f(_0x51bee0,_0x50d4f6);}import{create as _0x4529d4}from'../../worker/webgl.js';import{fromUserCoordinate,getUserProjection}from'../../proj.js';import{getUid}from'../../util.js';import{getWorldParameters}from'./worldUtil.js';import{listen,unlistenByKey}from'../../events.js';class WebGLPointsLayerRenderer extends _0x3cbb3b{constructor(_0x1bdd19,_0x67c79c){const _0x12d402=_0x362f,_0xaa99a=_0x67c79c['uniforms']||{},_0x2c1f39=_0x2426b5();_0xaa99a[DefaultUniform['PROJECTION_MATRIX']]=_0x2c1f39,super(_0x1bdd19,{'uniforms':_0xaa99a,'postProcesses':_0x67c79c[_0x12d402(0xc3)]}),this[_0x12d402(0xd6)]=-0x1,this[_0x12d402(0x110)]=new _0x41847f(ARRAY_BUFFER,DYNAMIC_DRAW),this['indicesBuffer_']=new _0x41847f(ELEMENT_ARRAY_BUFFER,DYNAMIC_DRAW),this[_0x12d402(0x11c)]=_0x67c79c['vertexShader'],this[_0x12d402(0x10b)]=_0x67c79c[_0x12d402(0xec)],this['program_'],this[_0x12d402(0xfc)]=_0x67c79c[_0x12d402(0xc7)]??!![];const _0x5f1a93=_0x67c79c[_0x12d402(0xd1)]?_0x67c79c['attributes']['map'](function(_0x5e9919){const _0x497275=_0x12d402;return{'name':_0x497275(0x113)+_0x5e9919[_0x497275(0xf6)],'size':0x1,'type':AttributeType[_0x497275(0x11d)]};}):[];this[_0x12d402(0xd1)]=[{'name':_0x12d402(0xdb),'size':0x2,'type':AttributeType[_0x12d402(0x11d)]},{'name':_0x12d402(0xe5),'size':0x1,'type':AttributeType[_0x12d402(0x11d)]}];this[_0x12d402(0xfc)]&&(this['attributes'][_0x12d402(0x133)]({'name':_0x12d402(0x118),'size':0x4,'type':AttributeType[_0x12d402(0x11d)]}),this[_0x12d402(0xd1)]['push']({'name':_0x12d402(0xff),'size':0x1,'type':AttributeType[_0x12d402(0x11d)]}));this['attributes'][_0x12d402(0x133)](..._0x5f1a93),this['customAttributes']=_0x67c79c[_0x12d402(0xd1)]?_0x67c79c[_0x12d402(0xd1)]:[],this[_0x12d402(0xe6)]=createEmpty(),this[_0x12d402(0xf2)]=_0x2c1f39,this[_0x12d402(0xc9)]=_0x2426b5(),this[_0x12d402(0x119)]=_0x2426b5(),this['renderInstructions_']=new Float32Array(0x0),this['hitRenderTarget_'],this[_0x12d402(0x116)]=0x0,this[_0x12d402(0xd9)]=_0x4529d4(),this['worker_']['addEventListener'](_0x12d402(0x121),_0x2e329e=>{const _0x2707cc=_0x12d402,_0x4a2133=_0x2e329e['data'];if(_0x4a2133[_0x2707cc(0xdd)]===WebGLWorkerMessageType[_0x2707cc(0xef)]){const _0x4b9ba7=_0x4a2133[_0x2707cc(0x12a)];this[_0x2707cc(0x110)]['fromArrayBuffer'](_0x4a2133[_0x2707cc(0x111)]),this[_0x2707cc(0xf4)]['flushBufferData'](this[_0x2707cc(0x110)]),this[_0x2707cc(0xee)][_0x2707cc(0xe2)](_0x4a2133[_0x2707cc(0xdc)]),this['helper'][_0x2707cc(0x12e)](this[_0x2707cc(0xee)]),this[_0x2707cc(0xc9)]=_0x4b9ba7,_0x55e97a(this[_0x2707cc(0x119)],this['renderTransform_']),this[_0x2707cc(0xe3)]=new Float32Array(_0x2e329e[_0x2707cc(0xcb)]['renderInstructions']),_0x4a2133['id']===this[_0x2707cc(0x116)]&&(this[_0x2707cc(0xfa)]=!![]),this[_0x2707cc(0x115)]()[_0x2707cc(0x114)]();}}),this[_0x12d402(0x11a)]={},this[_0x12d402(0x108)]=0x0;const _0x489c09=this[_0x12d402(0x115)]()['getSource']();this[_0x12d402(0x112)]=[listen(_0x489c09,_0x4841b3[_0x12d402(0xdf)],this[_0x12d402(0xd8)],this),listen(_0x489c09,_0x4841b3[_0x12d402(0xfb)],this[_0x12d402(0x12d)],this),listen(_0x489c09,_0x4841b3[_0x12d402(0xf5)],this[_0x12d402(0x11f)],this),listen(_0x489c09,_0x4841b3[_0x12d402(0x123)],this[_0x12d402(0xfd)],this)],_0x489c09['forEachFeature'](_0x21ba83=>{const _0x1f63d3=_0x12d402;this[_0x1f63d3(0x11a)][getUid(_0x21ba83)]={'feature':_0x21ba83,'properties':_0x21ba83['getProperties'](),'geometry':_0x21ba83[_0x1f63d3(0xf1)]()},this['featureCount_']++;});}['afterHelperCreated'](){const _0x4db5ff=_0x362f;this[_0x4db5ff(0x11e)]=this['helper'][_0x4db5ff(0xd2)](this[_0x4db5ff(0x10b)],this['vertexShader_']),this[_0x4db5ff(0xfc)]&&(this[_0x4db5ff(0xd7)]=new _0x430b47(this['helper'])),this['verticesBuffer_'][_0x4db5ff(0xed)]()&&this[_0x4db5ff(0xf4)][_0x4db5ff(0x12e)](this[_0x4db5ff(0x110)]),this[_0x4db5ff(0xee)][_0x4db5ff(0xed)]()&&this[_0x4db5ff(0xf4)][_0x4db5ff(0x12e)](this['indicesBuffer_']);}[_0x2271e9(0xd8)](_0x569a07){const _0x10c3ea=_0x2271e9,_0x1d85af=_0x569a07[_0x10c3ea(0xcd)];this[_0x10c3ea(0x11a)][getUid(_0x1d85af)]={'feature':_0x1d85af,'properties':_0x1d85af[_0x10c3ea(0xd0)](),'geometry':_0x1d85af['getGeometry']()},this[_0x10c3ea(0x108)]++;}['handleSourceFeatureChanged_'](_0x215193){const _0x523ac6=_0x2271e9,_0x15965c=_0x215193[_0x523ac6(0xcd)];this[_0x523ac6(0x11a)][getUid(_0x15965c)]={'feature':_0x15965c,'properties':_0x15965c[_0x523ac6(0xd0)](),'geometry':_0x15965c[_0x523ac6(0xf1)]()};}[_0x2271e9(0x11f)](_0x4d259e){const _0x42963d=_0x2271e9,_0x172ac7=_0x4d259e[_0x42963d(0xcd)];delete this[_0x42963d(0x11a)][getUid(_0x172ac7)],this[_0x42963d(0x108)]--;}['handleSourceFeatureClear_'](){const _0x5905bc=_0x2271e9;this['featureCache_']={},this[_0x5905bc(0x108)]=0x0;}[_0x2271e9(0xf0)](_0x4523ad){const _0x217f3a=_0x2271e9,_0x544f87=this['helper'][_0x217f3a(0x10f)]();this[_0x217f3a(0x10e)](_0x544f87,_0x4523ad);const [_0x1f5a43,_0x570489,_0x3add37]=getWorldParameters(_0x4523ad,this[_0x217f3a(0x115)]());this['renderWorlds'](_0x4523ad,![],_0x1f5a43,_0x570489,_0x3add37),this[_0x217f3a(0xf4)][_0x217f3a(0x106)](_0x4523ad,this[_0x217f3a(0xcc)],this['dispatchPostComposeEvent']);this[_0x217f3a(0xfc)]&&(this['renderWorlds'](_0x4523ad,!![],_0x1f5a43,_0x570489,_0x3add37),this['hitRenderTarget_'][_0x217f3a(0x12c)]());this[_0x217f3a(0xde)](_0x544f87,_0x4523ad);const _0x335aef=this[_0x217f3a(0xf4)][_0x217f3a(0xda)]();return _0x335aef;}[_0x2271e9(0xf8)](_0x1fd132){const _0x1cb5b3=_0x2271e9,_0x5562eb=this[_0x1cb5b3(0x115)](),_0x4f4b68=_0x5562eb[_0x1cb5b3(0x130)](),_0x25f726=_0x1fd132[_0x1cb5b3(0x109)],_0x896e3=!_0x1fd132[_0x1cb5b3(0x102)][_0x259f6a[_0x1cb5b3(0x10d)]]&&!_0x1fd132[_0x1cb5b3(0x102)][_0x259f6a[_0x1cb5b3(0xe9)]],_0x227b77=!equals(this[_0x1cb5b3(0xe6)],_0x1fd132['extent']),_0x280789=this[_0x1cb5b3(0xd6)]<_0x4f4b68['getRevision']();_0x280789&&(this['sourceRevision_']=_0x4f4b68[_0x1cb5b3(0xce)]());if(_0x896e3&&(_0x227b77||_0x280789)){const _0x34a3fe=_0x25f726[_0x1cb5b3(0x128)],_0x25d4d0=_0x25f726[_0x1cb5b3(0xc6)],_0x1aa911=_0x5562eb instanceof _0x2dbfeb?_0x5562eb[_0x1cb5b3(0xea)]():0x0,_0x355375=buffer(_0x1fd132[_0x1cb5b3(0x107)],_0x1aa911*_0x25d4d0);_0x4f4b68['loadFeatures'](_0x355375,_0x25d4d0,_0x34a3fe),this['rebuildBuffers_'](_0x1fd132),this['previousExtent_']=_0x1fd132['extent']['slice']();}return this[_0x1cb5b3(0xf4)][_0x1cb5b3(0x125)](this[_0x1cb5b3(0x11e)],_0x1fd132),this[_0x1cb5b3(0xf4)][_0x1cb5b3(0xcf)](_0x1fd132),this[_0x1cb5b3(0xf4)][_0x1cb5b3(0xf3)](this[_0x1cb5b3(0x110)]),this[_0x1cb5b3(0xf4)][_0x1cb5b3(0xf3)](this[_0x1cb5b3(0xee)]),this[_0x1cb5b3(0xf4)]['enableAttributes'](this[_0x1cb5b3(0xd1)]),!![];}[_0x2271e9(0xf9)](_0x598565){const _0x5b6cb2=_0x2271e9,_0x4f468b=_0x2426b5();this[_0x5b6cb2(0xf4)][_0x5b6cb2(0x11b)](_0x598565,_0x4f468b);const _0x10d289=getUserProjection(),_0x38352e=this[_0x5b6cb2(0xfc)]?0x7:0x2,_0x3863b8=_0x38352e+this[_0x5b6cb2(0x100)][_0x5b6cb2(0xeb)],_0x38bdf5=_0x3863b8*this['featureCount_'];(!this[_0x5b6cb2(0xe3)]||this[_0x5b6cb2(0xe3)][_0x5b6cb2(0xeb)]!==_0x38bdf5)&&(this[_0x5b6cb2(0xe3)]=new Float32Array(_0x38bdf5));let _0x30905f,_0x3a2816;const _0x485dc9=[],_0x3febb4=[];let _0x3e3ab1=-0x1;for(const _0x35474f in this[_0x5b6cb2(0x11a)]){_0x30905f=this['featureCache_'][_0x35474f],_0x3a2816=_0x30905f[_0x5b6cb2(0xe8)];if(!_0x3a2816||_0x3a2816['getType']()!==_0x5b6cb2(0xc5))continue;if(_0x10d289){const _0x2fdce9=fromUserCoordinate(_0x3a2816[_0x5b6cb2(0xe0)](),_0x598565[_0x5b6cb2(0x109)][_0x5b6cb2(0x128)]);_0x485dc9[0x0]=_0x2fdce9[0x0],_0x485dc9[0x1]=_0x2fdce9[0x1];}else _0x485dc9[0x0]=_0x3a2816['getFlatCoordinates']()[0x0],_0x485dc9[0x1]=_0x3a2816[_0x5b6cb2(0xe0)]()[0x1];_0x544dc4(_0x4f468b,_0x485dc9),this['renderInstructions_'][++_0x3e3ab1]=_0x485dc9[0x0],this[_0x5b6cb2(0xe3)][++_0x3e3ab1]=_0x485dc9[0x1];if(this[_0x5b6cb2(0xfc)]){const _0x240014=colorEncodeId(_0x3e3ab1+0x5,_0x3febb4);this[_0x5b6cb2(0xe3)][++_0x3e3ab1]=_0x240014[0x0],this['renderInstructions_'][++_0x3e3ab1]=_0x240014[0x1],this[_0x5b6cb2(0xe3)][++_0x3e3ab1]=_0x240014[0x2],this[_0x5b6cb2(0xe3)][++_0x3e3ab1]=_0x240014[0x3],this[_0x5b6cb2(0xe3)][++_0x3e3ab1]=Number(_0x35474f);}for(let _0x483681=0x0;_0x483681<this['customAttributes'][_0x5b6cb2(0xeb)];_0x483681++){const _0x8e204c=this['customAttributes'][_0x483681]['callback'](_0x30905f[_0x5b6cb2(0xcd)],_0x30905f['properties']);this['renderInstructions_'][++_0x3e3ab1]=_0x8e204c;}}const _0x497a87={'id':++this[_0x5b6cb2(0x116)],'type':WebGLWorkerMessageType['GENERATE_POINT_BUFFERS'],'renderInstructions':this['renderInstructions_'][_0x5b6cb2(0x132)],'customAttributesSize':_0x3863b8-0x2};_0x497a87['projectionTransform']=_0x4f468b,this[_0x5b6cb2(0xfa)]=![],this[_0x5b6cb2(0xd9)]['postMessage'](_0x497a87,[this['renderInstructions_'][_0x5b6cb2(0x132)]]),this[_0x5b6cb2(0xe3)]=null;}[_0x2271e9(0xe1)](_0x388531,_0x3e2036,_0xaf8b1e,_0x52ca74,_0xdf26df){const _0x3ff1c6=_0x2271e9;assert(this[_0x3ff1c6(0xfc)],_0x3ff1c6(0xd3));if(!this[_0x3ff1c6(0xe3)]||!this[_0x3ff1c6(0xfc)])return undefined;const _0x5d59d4=_0x544dc4(_0x3e2036['coordinateToPixelTransform'],_0x388531['slice']()),_0xece241=this[_0x3ff1c6(0xd7)][_0x3ff1c6(0x12b)](_0x5d59d4[0x0]/0x2,_0x5d59d4[0x1]/0x2),_0x560acb=[_0xece241[0x0]/0xff,_0xece241[0x1]/0xff,_0xece241[0x2]/0xff,_0xece241[0x3]/0xff],_0x46f628=colorDecodeId(_0x560acb),_0x6fd1a8=this[_0x3ff1c6(0xe3)][_0x46f628],_0x301fe1=Math[_0x3ff1c6(0x103)](_0x6fd1a8)[_0x3ff1c6(0xc4)](),_0x5e8a44=this[_0x3ff1c6(0x115)]()[_0x3ff1c6(0x130)](),_0x34f7e6=_0x5e8a44[_0x3ff1c6(0x126)](_0x301fe1);if(_0x34f7e6)return _0x52ca74(_0x34f7e6,this[_0x3ff1c6(0x115)](),null);return undefined;}[_0x2271e9(0x104)](_0xeb968f,_0x43d100,_0x23a3f4,_0x2b1e57,_0x17fc87){const _0x344f35=_0x2271e9;let _0xda09f5=_0x23a3f4;this['helper'][_0x344f35(0x125)](this[_0x344f35(0x11e)],_0xeb968f);_0x43d100&&(this[_0x344f35(0xd7)]['setSize']([Math['floor'](_0xeb968f[_0x344f35(0x134)][0x0]/0x2),Math[_0x344f35(0x103)](_0xeb968f[_0x344f35(0x134)][0x1]/0x2)]),this[_0x344f35(0xf4)][_0x344f35(0xd5)](_0xeb968f,this[_0x344f35(0xd7)],!![]));this[_0x344f35(0xf4)][_0x344f35(0xf3)](this[_0x344f35(0x110)]),this['helper'][_0x344f35(0xf3)](this[_0x344f35(0xee)]),this[_0x344f35(0xf4)]['enableAttributes'](this[_0x344f35(0xd1)]);do{this['helper'][_0x344f35(0x11b)](_0xeb968f,this[_0x344f35(0xf2)]),_0x116ff3(this[_0x344f35(0xf2)],_0xda09f5*_0x17fc87,0x0),_0x46502c(this[_0x344f35(0xf2)],this[_0x344f35(0x119)]),this[_0x344f35(0xf4)][_0x344f35(0x129)](_0xeb968f),this[_0x344f35(0xf4)][_0x344f35(0x101)](_0x43d100);const _0x5df9f7=this[_0x344f35(0xee)][_0x344f35(0xc8)]();this[_0x344f35(0xf4)][_0x344f35(0x131)](0x0,_0x5df9f7);}while(++_0xda09f5<_0x2b1e57);}[_0x2271e9(0x120)](){const _0x1fc237=_0x2271e9;this[_0x1fc237(0xd9)][_0x1fc237(0x117)](),this[_0x1fc237(0x112)][_0x1fc237(0x127)](function(_0x15f635){unlistenByKey(_0x15f635);}),this[_0x1fc237(0x112)]=null,super[_0x1fc237(0x120)]();}['renderDeclutter'](){}}export default WebGLPointsLayerRenderer;