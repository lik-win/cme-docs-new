const _0x27de1e=_0x31c8;(function(_0x285157,_0x52c554){const _0x1789e1=_0x31c8,_0x115bdd=_0x285157();while(!![]){try{const _0x23ccba=-parseInt(_0x1789e1(0x185))/0x1+-parseInt(_0x1789e1(0x181))/0x2+-parseInt(_0x1789e1(0x184))/0x3*(parseInt(_0x1789e1(0x162))/0x4)+parseInt(_0x1789e1(0x17b))/0x5*(parseInt(_0x1789e1(0x145))/0x6)+parseInt(_0x1789e1(0x16d))/0x7*(-parseInt(_0x1789e1(0x13c))/0x8)+-parseInt(_0x1789e1(0x16e))/0x9+parseInt(_0x1789e1(0x166))/0xa;if(_0x23ccba===_0x52c554)break;else _0x115bdd['push'](_0x115bdd['shift']());}catch(_0x2c92ed){_0x115bdd['push'](_0x115bdd['shift']());}}}(_0x552e,0x79d39));import _0x550f1e from'../../reproj/DataTile.js';function _0x31c8(_0x3a455b,_0x131f82){const _0x552e7b=_0x552e();return _0x31c8=function(_0x31c8ca,_0x2a16e1){_0x31c8ca=_0x31c8ca-0x138;let _0x3df00f=_0x552e7b[_0x31c8ca];return _0x3df00f;},_0x31c8(_0x3a455b,_0x131f82);}import _0x17e3cd from'../../reproj/Tile.js';import _0x394e50 from'../../TileState.js';import _0x40e95d from'../../webgl/TileTexture.js';import _0x5a59f9 from'../../webgl/Buffer.js';import _0x1e0357,{Uniforms as _0x7f1577,getCacheKey}from'./TileLayerBase.js';import{AttributeType}from'../../webgl/Helper.js';import{ELEMENT_ARRAY_BUFFER,STATIC_DRAW}from'../../webgl.js';import{apply as _0x40ffc7}from'../../transform.js';import{boundingExtent,containsCoordinate,getIntersection}from'../../extent.js';import{fromUserExtent}from'../../proj.js';import{fromTransform as _0x1d6814}from'../../vec/mat4.js';function _0x552e(){const _0x39b3b9=['tile','getExtent','frameState','getProgram','containsKey','getLayer','1157888avLtDB','viewState','getData','createTileRepresentation','indices_','getResolution','vertexShader_','TEXTURE_RESOLUTION','name','1014GhnyXl','reset','get','beforeTilesRender','length','ready','getMinZoom','getTexture','helper','setUniformFloatValue','disposeInternal','slice','u_textureOriginX','drawElements','TILE_TEXTURE_ARRAY','EMPTY','bindBuffer','getTileGridForProjection','program_','getZForResolution','getWrapX','getPixelData','DEPTH','paletteTextures','renderTile','getOrigin','tileRepresentationCache','a_textureCoord','fragmentShader_','4YyKoQw','fragmentShader','fromArray','bindTexture','15952060zUvLnk','delete','getState','getSize','TEXTURE_PIXEL_HEIGHT','u_texturePixelHeight','paletteTextures_','35pagofP','1191096ZzGXyE','getGL','TILE_TRANSFORM','afterHelperCreated','TRANSITION_ALPHA','pixelToCoordinateTransform','TEXTURE_PIXEL_WIDTH','RESOLUTION','textures','projection','u_texturePixelWidth','removeHelper','TEXTURE_COORD','23170xecQlC','deleteProgram','getTileCoordForCoordAndZ','ZOOM','TEXTURE_ORIGIN_Y','setUniformFloatVec4','468078VjZqmg','resolution','vertexShader','1698003gfWDcS','223287VKbVIb'];_0x552e=function(){return _0x39b3b9;};return _0x552e();}import{toSize}from'../../size.js';export const Uniforms={..._0x7f1577,'TILE_TEXTURE_ARRAY':'u_tileTextures','TEXTURE_PIXEL_WIDTH':_0x27de1e(0x178),'TEXTURE_PIXEL_HEIGHT':_0x27de1e(0x16b),'TEXTURE_RESOLUTION':'u_textureResolution','TEXTURE_ORIGIN_X':_0x27de1e(0x151),'TEXTURE_ORIGIN_Y':'u_textureOriginY'};export const Attributes={'TEXTURE_COORD':_0x27de1e(0x160)};const attributeDescriptions=[{'name':Attributes[_0x27de1e(0x17a)],'size':0x2,'type':AttributeType['FLOAT']}];class WebGLTileLayerRenderer extends _0x1e0357{constructor(_0x501bfe,_0xd6b296){const _0x27edff=_0x27de1e;super(_0x501bfe,_0xd6b296),this['program_'],this['vertexShader_']=_0xd6b296[_0x27edff(0x183)],this[_0x27edff(0x161)]=_0xd6b296[_0x27edff(0x163)],this['indices_']=new _0x5a59f9(ELEMENT_ARRAY_BUFFER,STATIC_DRAW),this['indices_'][_0x27edff(0x164)]([0x0,0x1,0x3,0x1,0x2,0x3]),this[_0x27edff(0x16c)]=_0xd6b296[_0x27edff(0x15c)]||[];}[_0x27de1e(0x146)](_0xaaf10f){const _0x191873=_0x27de1e;super[_0x191873(0x146)](_0xaaf10f);if(this[_0x191873(0x14d)]){const _0x29298a=this['helper'][_0x191873(0x16f)]();for(const _0x20757e of this[_0x191873(0x16c)]){_0x20757e['delete'](_0x29298a);}}this['vertexShader_']=_0xaaf10f[_0x191873(0x183)],this[_0x191873(0x161)]=_0xaaf10f[_0x191873(0x163)],this[_0x191873(0x16c)]=_0xaaf10f[_0x191873(0x15c)]||[];if(this[_0x191873(0x14d)]){this[_0x191873(0x157)]=this[_0x191873(0x14d)]['getProgram'](this[_0x191873(0x161)],this[_0x191873(0x142)]);const _0x5ae3d2=this[_0x191873(0x14d)][_0x191873(0x16f)]();for(const _0x20e2b6 of this[_0x191873(0x16c)]){_0x20e2b6[_0x191873(0x14c)](_0x5ae3d2);}}}[_0x27de1e(0x171)](){const _0xd5c387=_0x27de1e;super[_0xd5c387(0x171)]();const _0x25ea50=this['helper'][_0xd5c387(0x16f)]();for(const _0x58fc35 of this['paletteTextures_']){_0x58fc35[_0xd5c387(0x14c)](_0x25ea50);}this[_0xd5c387(0x157)]=this[_0xd5c387(0x14d)][_0xd5c387(0x139)](this[_0xd5c387(0x161)],this[_0xd5c387(0x142)]),this[_0xd5c387(0x14d)]['flushBufferData'](this['indices_']);}[_0x27de1e(0x179)](){const _0x104596=_0x27de1e;if(this[_0x104596(0x14d)]){const _0x3978de=this[_0x104596(0x14d)][_0x104596(0x16f)]();for(const _0x579696 of this[_0x104596(0x16c)]){_0x579696[_0x104596(0x167)](_0x3978de);}}super[_0x104596(0x179)]();}[_0x27de1e(0x13f)](_0xed3e64){return new _0x40e95d(_0xed3e64);}[_0x27de1e(0x148)](_0x4dfd66,_0x487468){const _0x48281c=_0x27de1e;super[_0x48281c(0x148)](_0x4dfd66,_0x487468),this[_0x48281c(0x14d)]['useProgram'](this[_0x48281c(0x157)],_0x4dfd66);}[_0x27de1e(0x15d)](_0x12f038,_0x3b3bdb,_0x2b5749,_0x85218c,_0x309725,_0x2ba188,_0x2bc3dd,_0x550022,_0x1fc306,_0x3ab5c7,_0x2a8fa3){const _0x510ed1=_0x27de1e,_0x24925c=this[_0x510ed1(0x14d)][_0x510ed1(0x16f)]();this[_0x510ed1(0x14d)][_0x510ed1(0x155)](_0x12f038['coords']),this[_0x510ed1(0x14d)][_0x510ed1(0x155)](this[_0x510ed1(0x140)]),this['helper']['enableAttributes'](attributeDescriptions);let _0x2feb29=0x0;while(_0x2feb29<_0x12f038[_0x510ed1(0x176)][_0x510ed1(0x149)]){const _0x16f134=Uniforms[_0x510ed1(0x153)]+'['+_0x2feb29+']';this['helper']['bindTexture'](_0x12f038[_0x510ed1(0x176)][_0x2feb29],_0x2feb29,_0x16f134),++_0x2feb29;}for(let _0x31b2e8=0x0;_0x31b2e8<this[_0x510ed1(0x16c)][_0x510ed1(0x149)];++_0x31b2e8){const _0x29d549=this[_0x510ed1(0x16c)][_0x31b2e8],_0xeeabe0=_0x29d549[_0x510ed1(0x14c)](_0x24925c);this[_0x510ed1(0x14d)][_0x510ed1(0x165)](_0xeeabe0,_0x2feb29,_0x29d549[_0x510ed1(0x144)]),++_0x2feb29;}const _0x4645d2=_0x2b5749['viewState'],_0x245449=_0x2ba188[0x0]+0x2*_0x3ab5c7,_0x12d797=_0x2ba188[0x1]+0x2*_0x3ab5c7,_0x29bddc=_0x12f038[_0x510ed1(0x186)],_0x536276=_0x29bddc['tileCoord'],_0x5551f7=_0x536276[0x1],_0xb0b182=_0x536276[0x2];this[_0x510ed1(0x14d)]['setUniformMatrixValue'](Uniforms[_0x510ed1(0x170)],_0x1d6814(this['tempMat4'],_0x3b3bdb)),this[_0x510ed1(0x14d)]['setUniformFloatValue'](Uniforms[_0x510ed1(0x172)],_0x2a8fa3),this['helper'][_0x510ed1(0x14e)](Uniforms[_0x510ed1(0x15b)],_0x1fc306);let _0x2be6b5=_0x85218c;_0x3ab5c7>0x0&&(_0x2be6b5=_0x550022,getIntersection(_0x2be6b5,_0x85218c,_0x2be6b5)),this[_0x510ed1(0x14d)][_0x510ed1(0x180)](Uniforms['RENDER_EXTENT'],_0x2be6b5),this[_0x510ed1(0x14d)][_0x510ed1(0x14e)](Uniforms[_0x510ed1(0x175)],_0x4645d2[_0x510ed1(0x182)]),this[_0x510ed1(0x14d)]['setUniformFloatValue'](Uniforms[_0x510ed1(0x17e)],_0x4645d2['zoom']),this[_0x510ed1(0x14d)]['setUniformFloatValue'](Uniforms[_0x510ed1(0x174)],_0x245449),this[_0x510ed1(0x14d)][_0x510ed1(0x14e)](Uniforms[_0x510ed1(0x16a)],_0x12d797),this[_0x510ed1(0x14d)][_0x510ed1(0x14e)](Uniforms[_0x510ed1(0x143)],_0x309725),this[_0x510ed1(0x14d)][_0x510ed1(0x14e)](Uniforms['TEXTURE_ORIGIN_X'],_0x2bc3dd[0x0]+_0x5551f7*_0x2ba188[0x0]*_0x309725-_0x3ab5c7*_0x309725),this[_0x510ed1(0x14d)]['setUniformFloatValue'](Uniforms[_0x510ed1(0x17f)],_0x2bc3dd[0x1]-_0xb0b182*_0x2ba188[0x1]*_0x309725+_0x3ab5c7*_0x309725),this[_0x510ed1(0x14d)][_0x510ed1(0x152)](0x0,this[_0x510ed1(0x140)][_0x510ed1(0x169)]());}[_0x27de1e(0x13e)](_0x693f66){const _0x2c8d26=_0x27de1e,_0x27f62e=this[_0x2c8d26(0x14d)]['getGL']();if(!_0x27f62e)return null;const _0x3286bf=this[_0x2c8d26(0x138)];if(!_0x3286bf)return null;const _0x1a3235=this[_0x2c8d26(0x13b)](),_0x449fdb=_0x40ffc7(_0x3286bf[_0x2c8d26(0x173)],_0x693f66[_0x2c8d26(0x150)]()),_0x43470c=_0x3286bf[_0x2c8d26(0x13d)],_0x40ffb5=_0x1a3235[_0x2c8d26(0x187)]();if(_0x40ffb5){if(!containsCoordinate(fromUserExtent(_0x40ffb5,_0x43470c[_0x2c8d26(0x177)]),_0x449fdb))return null;}const _0x79b574=_0x1a3235['getSources'](boundingExtent([_0x449fdb]),_0x43470c[_0x2c8d26(0x182)]);let _0x4ec4a0,_0x4151bd,_0x1dd6f4;for(_0x4ec4a0=_0x79b574[_0x2c8d26(0x149)]-0x1;_0x4ec4a0>=0x0;--_0x4ec4a0){_0x4151bd=_0x79b574[_0x4ec4a0];if(_0x4151bd[_0x2c8d26(0x168)]()===_0x2c8d26(0x14a)){_0x1dd6f4=_0x4151bd[_0x2c8d26(0x156)](_0x43470c[_0x2c8d26(0x177)]);if(_0x4151bd[_0x2c8d26(0x159)]())break;const _0x329e92=_0x1dd6f4[_0x2c8d26(0x187)]();if(!_0x329e92||containsCoordinate(_0x329e92,_0x449fdb))break;}}if(_0x4ec4a0<0x0)return null;const _0x2f2945=this[_0x2c8d26(0x15f)];for(let _0x8eb06e=_0x1dd6f4[_0x2c8d26(0x158)](_0x43470c[_0x2c8d26(0x182)]);_0x8eb06e>=_0x1dd6f4[_0x2c8d26(0x14b)]();--_0x8eb06e){const _0x5a0c61=_0x1dd6f4[_0x2c8d26(0x17d)](_0x449fdb,_0x8eb06e),_0x34c8f5=getCacheKey(_0x4151bd,_0x5a0c61);if(!_0x2f2945[_0x2c8d26(0x13a)](_0x34c8f5))continue;const _0x7f4530=_0x2f2945[_0x2c8d26(0x147)](_0x34c8f5),_0x8ce84f=_0x7f4530[_0x2c8d26(0x186)];if((_0x8ce84f instanceof _0x17e3cd||_0x8ce84f instanceof _0x550f1e)&&_0x8ce84f[_0x2c8d26(0x168)]()===_0x394e50[_0x2c8d26(0x154)])return null;if(!_0x7f4530['loaded'])continue;const _0x37fe16=_0x1dd6f4[_0x2c8d26(0x15e)](_0x8eb06e),_0x669262=toSize(_0x1dd6f4['getTileSize'](_0x8eb06e)),_0x140c7f=_0x1dd6f4[_0x2c8d26(0x141)](_0x8eb06e),_0x12ff89=(_0x449fdb[0x0]-_0x37fe16[0x0])/_0x140c7f-_0x5a0c61[0x1]*_0x669262[0x0],_0x4d598f=(_0x37fe16[0x1]-_0x449fdb[0x1])/_0x140c7f-_0x5a0c61[0x2]*_0x669262[0x1];return _0x7f4530[_0x2c8d26(0x15a)](_0x12ff89,_0x4d598f);}return null;}[_0x27de1e(0x14f)](){const _0x461d72=_0x27de1e,_0x537fb6=this['helper'];if(_0x537fb6){const _0x3760f2=_0x537fb6[_0x461d72(0x16f)]();for(const _0x4b4ecb of this['paletteTextures_']){_0x4b4ecb[_0x461d72(0x167)](_0x3760f2);}this[_0x461d72(0x16c)][_0x461d72(0x149)]=0x0,_0x3760f2[_0x461d72(0x17c)](this['program_']),delete this['program_'],_0x537fb6['deleteBuffer'](this[_0x461d72(0x140)]);}super[_0x461d72(0x14f)](),delete this[_0x461d72(0x140)];}}export default WebGLTileLayerRenderer;