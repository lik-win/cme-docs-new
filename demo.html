<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>时间轴组件</title>
  <link rel="stylesheet" href="/demo.css" />
  <link rel="stylesheet" href="/libs/timeline/cme-timeline.css">
  <script type="text/javascript" src="/libs/cme2d.js"></script>
  <script type="text/javascript" src="/libs/vue3.js"></script>
  <script type="text/javascript" src="/libs/timeline/cme-timeline.js"></script>
  <style type="text/css">
    #app {
      position: absolute;
      bottom: 0;
      width: 100%;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <div id="app">
    <cme-timeline :theme="theme" />
  </div>
  <script type="text/javascript">
    const { Map: CMEMap, View, source, layer } = window.CME2D;
    function initMap(mapEl) {
      const map = new CMEMap({
        target: mapEl,//挂载实例
        layers: [
          new layer.Tile({
            preload: Infinity, //开启预加载模式
            source: new source.XYZ({
              url: 'http://10.0.54.106:8080/windy/{z}/{x}/{y}.png '   // 内网地址
              // url: 'http://111.205.114.224:8080/windy/{z}/{x}/{y}.png'   // 外网地址
            })
          })
        ],
        view: new View({ //地图视图
          center: [106, 35],
          projection: "EPSG:4326",
          zoom: 5,
          wrapX: true,
        }),//地图设置
        controls: [],//取消地图操作
      });
      return map;
    }
    initMap(document.querySelector('#map'));

    const { createApp, ref } = Vue;
    const { Timeline, useTimeline } = CMETimeline;
    const app = createApp({
      setup() {
        // 主题，时间轴组件支持 dark 和 light 两种主题
        const theme = ref('light');
        const timeline = useTimeline();
        console.log('timeline ==>', timeline, timeline.getOptions());
        // 添加时间轴任务，时间轴刻度变化时执行的方法，每个任务都有对应的taskId
        timeline.addTask('testTask', function (params, flag) {
          // 如果状态为停止，则不应该继续执行
          if (!flag.value) return;
          // 时间轴更新刻度时执行的代码
          console.log('时间轴播放任务:', params);
        });
        // 时间轴任务id，任务函数的参数，是否立即触发
        const params = {
          // 时间轴调用任务时传递给任务函数的参数
          params: { taskId: 'testTask' },
          // 时间字段，默认为 time
          timeField: 'myTime'
        };
        // 设置当前任务（可用于时间轴在多个任务之间切换）
        timeline.setCurrentTask('testTask', params, true);
        return { theme }
      }
    });
    app.use(Timeline);
    app.mount('#app');
  </script>
</body>

</html>