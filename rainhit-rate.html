<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>基于降水的命中率</title>
  </head>

  <body style="margin: 0;width:100vw;height: 100vh;">
    <div id="Echart" style="width: 100%; height: 100%"></div>
    <script
      type="text/javascript"
      async=""
      src="/libs/echarts.js"
      data-loaded="true"
    ></script>
    <script src="/libs/dayjs.js"></script>
    <script src="/libs/axios.js"></script>
    <script type="text/javascript">
      let chart = null,option={}
      const apiInfo = {
        url: 'http://10.40.88.119:11040/algorithm/scope1',
        args: {
          element: {
            value: 'RAIN',
            type: 'string',
            required: true,
            desc: '要素',
          },
          childElement: {
            value: 't_rain_12h_data',
            type: 'string',
            required: true,
            desc: '子要素',
          },
          models: {
            value: ["SCMOC","EC"],
            type: 'array',
            required: true,
            desc: '模式',
          },
          observationTime: {
            value: '2024-12-03 08:00:00',
            type: 'string',
            required: true,
            desc: '实况时间',
          },
          scopeType: {
            value: 'HITRATE',
            type: 'string',
            required: true,
            desc: '评分类型',
          },
          stationType: {
            value: '10290',
            type: 'string',
            required: true,
            desc: '站点',
          },
          forecastTime: {
            value: '2024-12-02T20:00_12',
            type: 'string',
            required: true,
            desc: '起报时次',
          },
        },
      }
      
      const _request = (val) => {
        const params ={
            "element": "RAIN",
            "childElement": "t_rain_12h_data",
            "models": ["SCMOC","EC"],
            "thresholds": ["0.1"],
            "observationTime": "2024-12-03 08:00:00",
            "scopeType": "HITRATE",
            "stationType":"10290",
            "forecastTime":"2024-12-02T20:00_12",
            "area": {"type":"province","value":["全国","北京","天津"]}
        }
          fetch(apiInfo.url,{
            method: "POST",
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json',
            },
            body:JSON.stringify(params)}).then(res => res.json()).then(d => {
            console.log('fetch =>', d)
            let {data}=d
            let series = []
              data.series.map((item) => {
                series.push({
                  type: 'bar',
                  name: item.name,
                  data: item.data,
                  barGap: 0.1,
                  label: {
                    normal: {
                      show: true,
                      position:'insideTop', //相对位置
                      formatter: '{c}',
                    },
                  },
                  
                })
              })
              option.xAxis.data =data.xaxis
              option.series = series
              chart.setOption(option)
              chart.resize()
          })
      }
      function initEchart() {
         option = {
          'title': {
            left:'center',
            right:'center',
            top: '2%',
          'text':'基于降水的命中率',
            color: '#333',
            fontSize: '16',
            subtextStyle: {
              color: '#90979c',
              fontSize: '16'
            }
          },
          legend: {
            left:'center',
            right:'center',
            top: '8%',
            color: '#90979c',
          },
          color: [
            '#fba400',
            '#335cce',
            '#1b9d3b',
            '#e25e30',
            '#b92727',
            '#359fdc',
            '#30c8c6',
            '#4b52ab',
            '#d13abd',
            '#7fa771',
            '#8993a5',
            '#c0826a',
            '#894cd4',
          ],
          tooltip: {
            trigger: 'axis',
            fontSize: 14,
          },
          grid: {
            top: '15%',
            left: '10%',
            right: '8%',
            bottom: 30,
          containLabel: true, //包括文本，居中
      },
          xAxis: {
            type: 'category',
            data: [],
            axisLabel: {
              margin: 10,
              textStyle: {
                fontSize: 14,
              },
            },
            axisLine: {
              lineStyle: {
                color: '#477AA5',
              },
            },
            axisTick: {
              show: false,
            },
            splitLine: {
              show: false,
            },
          },
          yAxis: {
            type: 'value',
            splitNumber: 7,
            boundaryGap: ['0', '1%'],
            axisLine: { show: true },
            axisTick: { show: false },
            splitLine: {
              show: true,
              lineStyle: {
                type: 'dashed',
                color: '#000',
              },
            },
            axisLabel: {
              margin: 10,
              textStyle: {
                color: '#000',
              },
            },
          },
          series: [],
        }
        const dom = document.getElementById('Echart')
        chart = echarts.init(dom)
      }
      window.onload = function () {
        initEchart()
        onRun()
        window.addEventListener('resize', () => {
          chart?.resize()
        })
      }
      function onRun(params){
        _request(params)
      }
    </script>
  </body>
</html>
